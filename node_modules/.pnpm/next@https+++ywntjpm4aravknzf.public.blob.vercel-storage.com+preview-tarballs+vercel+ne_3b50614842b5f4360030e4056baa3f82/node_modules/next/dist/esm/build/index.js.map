{"version":3,"sources":["../../src/build/index.ts"],"sourcesContent":["import type { AppBuildManifest } from './webpack/plugins/app-build-manifest-plugin'\nimport type { PagesManifest } from './webpack/plugins/pages-manifest-plugin'\nimport type { ExportPathMap, NextConfigComplete } from '../server/config-shared'\nimport type { MiddlewareManifest } from './webpack/plugins/middleware-plugin'\nimport type { ActionManifest } from './webpack/plugins/flight-client-entry-plugin'\nimport type { CacheControl, Revalidate } from '../server/lib/cache-control'\n\nimport '../lib/setup-exception-listeners'\n\nimport { loadEnvConfig, type LoadedEnvFiles } from '@next/env'\nimport { bold, yellow } from '../lib/picocolors'\nimport crypto from 'crypto'\nimport { makeRe } from 'next/dist/compiled/picomatch'\nimport { existsSync, promises as fs } from 'fs'\nimport os from 'os'\nimport { Worker } from '../lib/worker'\nimport { defaultConfig } from '../server/config-shared'\nimport devalue from 'next/dist/compiled/devalue'\nimport findUp from 'next/dist/compiled/find-up'\nimport { nanoid } from 'next/dist/compiled/nanoid/index.cjs'\nimport path from 'path'\nimport {\n  STATIC_STATUS_PAGE_GET_INITIAL_PROPS_ERROR,\n  PUBLIC_DIR_MIDDLEWARE_CONFLICT,\n  MIDDLEWARE_FILENAME,\n  PAGES_DIR_ALIAS,\n  INSTRUMENTATION_HOOK_FILENAME,\n  RSC_PREFETCH_SUFFIX,\n  RSC_SUFFIX,\n  NEXT_RESUME_HEADER,\n  PRERENDER_REVALIDATE_HEADER,\n  PRERENDER_REVALIDATE_ONLY_GENERATED_HEADER,\n  NEXT_CACHE_REVALIDATE_TAG_TOKEN_HEADER,\n  NEXT_CACHE_REVALIDATED_TAGS_HEADER,\n  MATCHED_PATH_HEADER,\n  RSC_SEGMENTS_DIR_SUFFIX,\n  RSC_SEGMENT_SUFFIX,\n} from '../lib/constants'\nimport { FileType, fileExists } from '../lib/file-exists'\nimport { findPagesDir } from '../lib/find-pages-dir'\nimport loadCustomRoutes, {\n  normalizeRouteRegex,\n} from '../lib/load-custom-routes'\nimport type {\n  CustomRoutes,\n  Header,\n  Redirect,\n  Rewrite,\n  RouteHas,\n} from '../lib/load-custom-routes'\nimport { nonNullable } from '../lib/non-nullable'\nimport { recursiveDelete } from '../lib/recursive-delete'\nimport { verifyPartytownSetup } from '../lib/verify-partytown-setup'\nimport {\n  BUILD_ID_FILE,\n  BUILD_MANIFEST,\n  CLIENT_STATIC_FILES_PATH,\n  EXPORT_DETAIL,\n  EXPORT_MARKER,\n  IMAGES_MANIFEST,\n  PAGES_MANIFEST,\n  PHASE_PRODUCTION_BUILD,\n  PRERENDER_MANIFEST,\n  REACT_LOADABLE_MANIFEST,\n  ROUTES_MANIFEST,\n  SERVER_DIRECTORY,\n  SERVER_FILES_MANIFEST,\n  STATIC_STATUS_PAGES,\n  MIDDLEWARE_MANIFEST,\n  APP_PATHS_MANIFEST,\n  APP_PATH_ROUTES_MANIFEST,\n  APP_BUILD_MANIFEST,\n  RSC_MODULE_TYPES,\n  NEXT_FONT_MANIFEST,\n  SUBRESOURCE_INTEGRITY_MANIFEST,\n  MIDDLEWARE_BUILD_MANIFEST,\n  MIDDLEWARE_REACT_LOADABLE_MANIFEST,\n  SERVER_REFERENCE_MANIFEST,\n  FUNCTIONS_CONFIG_MANIFEST,\n  UNDERSCORE_NOT_FOUND_ROUTE_ENTRY,\n  UNDERSCORE_NOT_FOUND_ROUTE,\n  DYNAMIC_CSS_MANIFEST,\n  TURBOPACK_CLIENT_MIDDLEWARE_MANIFEST,\n} from '../shared/lib/constants'\nimport {\n  getSortedRoutes,\n  isDynamicRoute,\n  getSortedRouteObjects,\n} from '../shared/lib/router/utils'\nimport type { __ApiPreviewProps } from '../server/api-utils'\nimport loadConfig from '../server/config'\nimport type { BuildManifest } from '../server/get-page-files'\nimport { normalizePagePath } from '../shared/lib/page-path/normalize-page-path'\nimport { getPagePath } from '../server/require'\nimport * as ciEnvironment from '../server/ci-info'\nimport {\n  turborepoTraceAccess,\n  TurborepoAccessTraceResult,\n  writeTurborepoAccessTraceResult,\n} from './turborepo-access-trace'\n\nimport {\n  eventBuildOptimize,\n  eventCliSession,\n  eventBuildFeatureUsage,\n  eventNextPlugins,\n  EVENT_BUILD_FEATURE_USAGE,\n  eventPackageUsedInGetServerSideProps,\n  eventBuildCompleted,\n  eventBuildFailed,\n} from '../telemetry/events'\nimport type { EventBuildFeatureUsage } from '../telemetry/events'\nimport { Telemetry } from '../telemetry/storage'\nimport { hadUnsupportedValue } from './analysis/get-page-static-info'\nimport {\n  createPagesMapping,\n  getStaticInfoIncludingLayouts,\n  sortByPageExts,\n} from './entries'\nimport { PAGE_TYPES } from '../lib/page-types'\nimport { generateBuildId } from './generate-build-id'\nimport { isWriteable } from './is-writeable'\nimport * as Log from './output/log'\nimport createSpinner from './spinner'\nimport { trace, flushAllTraces, setGlobal, type Span } from '../trace'\nimport {\n  detectConflictingPaths,\n  computeFromManifest,\n  getJsPageSizeInKb,\n  printCustomRoutes,\n  printTreeView,\n  copyTracedFiles,\n  isReservedPage,\n  isAppBuiltinNotFoundPage,\n  collectRoutesUsingEdgeRuntime,\n  collectMeta,\n} from './utils'\nimport type { PageInfo, PageInfos } from './utils'\nimport type { PrerenderedRoute } from './static-paths/types'\nimport type { AppSegmentConfig } from './segment-config/app/app-segment-config'\nimport { writeBuildId } from './write-build-id'\nimport { normalizeLocalePath } from '../shared/lib/i18n/normalize-locale-path'\nimport isError from '../lib/is-error'\nimport type { NextError } from '../lib/is-error'\nimport { isEdgeRuntime } from '../lib/is-edge-runtime'\nimport { recursiveCopy } from '../lib/recursive-copy'\nimport { recursiveReadDir } from '../lib/recursive-readdir'\nimport { lockfilePatchPromise, teardownTraceSubscriber } from './swc'\nimport { getNamedRouteRegex } from '../shared/lib/router/utils/route-regex'\nimport { getFilesInDir } from '../lib/get-files-in-dir'\nimport { eventSwcPlugins } from '../telemetry/events/swc-plugins'\nimport { normalizeAppPath } from '../shared/lib/router/utils/app-paths'\nimport {\n  ACTION_HEADER,\n  NEXT_ROUTER_PREFETCH_HEADER,\n  RSC_HEADER,\n  RSC_CONTENT_TYPE_HEADER,\n  NEXT_ROUTER_STATE_TREE_HEADER,\n  NEXT_DID_POSTPONE_HEADER,\n  NEXT_ROUTER_SEGMENT_PREFETCH_HEADER,\n  NEXT_REWRITTEN_PATH_HEADER,\n  NEXT_REWRITTEN_QUERY_HEADER,\n} from '../client/components/app-router-headers'\nimport { webpackBuild } from './webpack-build'\nimport { NextBuildContext, type MappedPages } from './build-context'\nimport { normalizePathSep } from '../shared/lib/page-path/normalize-path-sep'\nimport { isAppRouteRoute } from '../lib/is-app-route-route'\nimport { createClientRouterFilter } from '../lib/create-client-router-filter'\nimport { createValidFileMatcher } from '../server/lib/find-page-file'\nimport { startTypeChecking } from './type-check'\nimport { generateInterceptionRoutesRewrites } from '../lib/generate-interception-routes-rewrites'\n\nimport { buildDataRoute } from '../server/lib/router-utils/build-data-route'\nimport { collectBuildTraces } from './collect-build-traces'\nimport type { BuildTraceContext } from './webpack/plugins/next-trace-entrypoints-plugin'\nimport { formatManifest } from './manifests/formatter/format-manifest'\nimport {\n  recordFrameworkVersion,\n  updateBuildDiagnostics,\n  recordFetchMetrics,\n} from '../diagnostics/build-diagnostics'\nimport { getStartServerInfo, logStartInfo } from '../server/lib/app-info-log'\nimport type { NextEnabledDirectories } from '../server/base-server'\nimport { hasCustomExportOutput } from '../export/utils'\nimport { buildCustomRoute } from '../lib/build-custom-route'\nimport { traceMemoryUsage } from '../lib/memory/trace'\nimport { generateEncryptionKeyBase64 } from '../server/app-render/encryption-utils-server'\nimport type { DeepReadonly } from '../shared/lib/deep-readonly'\nimport uploadTrace from '../trace/upload-trace'\nimport {\n  checkIsAppPPREnabled,\n  checkIsRoutePPREnabled,\n} from '../server/lib/experimental/ppr'\nimport { FallbackMode, fallbackModeToFallbackField } from '../lib/fallback'\nimport { RenderingMode } from './rendering-mode'\nimport { InvariantError } from '../shared/lib/invariant-error'\nimport { HTML_LIMITED_BOT_UA_RE_STRING } from '../shared/lib/router/utils/is-bot'\nimport type { UseCacheTrackerKey } from './webpack/plugins/telemetry-plugin/use-cache-tracker-utils'\nimport {\n  buildInversePrefetchSegmentDataRoute,\n  buildPrefetchSegmentDataRoute,\n  type PrefetchSegmentDataRoute,\n} from '../server/lib/router-utils/build-prefetch-segment-data-route'\n\nimport { turbopackBuild } from './turbopack-build'\nimport { isPersistentCachingEnabled } from '../shared/lib/turbopack/utils'\nimport { inlineStaticEnv } from '../lib/inline-static-env'\nimport { populateStaticEnv } from '../lib/static-env'\nimport { durationToString } from './duration-to-string'\nimport { traceGlobals } from '../trace/shared'\nimport { extractNextErrorCode } from '../lib/error-telemetry-utils'\nimport { runAfterProductionCompile } from './after-production-compile'\n\ntype Fallback = null | boolean | string\n\nexport interface PrerenderManifestRoute {\n  dataRoute: string | null\n  experimentalBypassFor?: RouteHas[]\n\n  /**\n   * The headers that should be served along side this prerendered route.\n   */\n  initialHeaders?: Record<string, string>\n\n  /**\n   * The status code that should be served along side this prerendered route.\n   */\n  initialStatus?: number\n\n  /**\n   * The revalidate value for this route. This might be inferred from:\n   * - route segment configs\n   * - fetch calls\n   * - unstable_cache\n   * - \"use cache\"\n   */\n  initialRevalidateSeconds: Revalidate\n\n  /**\n   * The expire value for this route, which is inferred from the \"use cache\"\n   * functions that are used by the route, or the expireTime config.\n   */\n  initialExpireSeconds: number | undefined\n\n  /**\n   * The prefetch data route associated with this page. If not defined, this\n   * page does not support prefetching.\n   */\n  prefetchDataRoute: string | null | undefined\n\n  /**\n   * The dynamic route that this statically prerendered route is based on. If\n   * this is null, then the route was not based on a dynamic route.\n   */\n  srcRoute: string | null\n\n  /**\n   * @deprecated use `renderingMode` instead\n   */\n  experimentalPPR: boolean | undefined\n\n  /**\n   * The rendering mode for this route. Only `undefined` when not an app router\n   * route.\n   */\n  renderingMode: RenderingMode | undefined\n\n  /**\n   * The headers that are allowed to be used when revalidating this route. These\n   * are used internally by Next.js to revalidate routes.\n   */\n  allowHeader: string[]\n}\n\nexport interface DynamicPrerenderManifestRoute {\n  dataRoute: string | null\n  dataRouteRegex: string | null\n  experimentalBypassFor?: RouteHas[]\n  fallback: Fallback\n\n  /**\n   * When defined, it describes the revalidation configuration for the fallback\n   * route.\n   */\n  fallbackRevalidate: Revalidate | undefined\n\n  /**\n   * When defined, it describes the expire configuration for the fallback route.\n   */\n  fallbackExpire: number | undefined\n\n  /**\n   * The headers that should used when serving the fallback.\n   */\n  fallbackHeaders?: Record<string, string>\n\n  /**\n   * The status code that should be used when serving the fallback.\n   */\n  fallbackStatus?: number\n\n  /**\n   * The root params that are unknown for this fallback route.\n   */\n  fallbackRootParams: readonly string[] | undefined\n\n  /**\n   * The source route that this fallback route is based on. This is a reference\n   * so that we can associate this dynamic route with the correct source.\n   */\n  fallbackSourceRoute: string | undefined\n\n  prefetchDataRoute: string | null | undefined\n  prefetchDataRouteRegex: string | null | undefined\n  routeRegex: string\n\n  /**\n   * @deprecated use `renderingMode` instead\n   */\n  experimentalPPR: boolean | undefined\n\n  /**\n   * The rendering mode for this route. Only `undefined` when not an app router\n   * route.\n   */\n  renderingMode: RenderingMode | undefined\n\n  /**\n   * The headers that are allowed to be used when revalidating this route. These\n   * are used internally by Next.js to revalidate routes.\n   */\n  allowHeader: string[]\n}\n\n/**\n * The headers that are allowed to be used when revalidating routes. Currently\n * this includes both headers used by the pages and app routers.\n */\nconst ALLOWED_HEADERS: string[] = [\n  'host',\n  MATCHED_PATH_HEADER,\n  PRERENDER_REVALIDATE_HEADER,\n  PRERENDER_REVALIDATE_ONLY_GENERATED_HEADER,\n  NEXT_CACHE_REVALIDATED_TAGS_HEADER,\n  NEXT_CACHE_REVALIDATE_TAG_TOKEN_HEADER,\n]\n\nexport type PrerenderManifest = {\n  version: 4\n  routes: { [route: string]: PrerenderManifestRoute }\n  dynamicRoutes: { [route: string]: DynamicPrerenderManifestRoute }\n  notFoundRoutes: string[]\n  preview: __ApiPreviewProps\n}\n\ntype ManifestBuiltRoute = {\n  /**\n   * The route pattern used to match requests for this route.\n   */\n  regex: string\n}\n\nexport type ManifestRewriteRoute = ManifestBuiltRoute & Rewrite\nexport type ManifestRedirectRoute = ManifestBuiltRoute & Redirect\nexport type ManifestHeaderRoute = ManifestBuiltRoute & Header\n\nexport type ManifestRoute = ManifestBuiltRoute & {\n  page: string\n  namedRegex?: string\n  routeKeys?: { [key: string]: string }\n  prefetchSegmentDataRoutes?: PrefetchSegmentDataRoute[]\n}\n\ntype ManifestDataRoute = {\n  page: string\n  routeKeys?: { [key: string]: string }\n  dataRouteRegex: string\n  namedDataRouteRegex?: string\n}\n\nexport type RoutesManifest = {\n  version: number\n  pages404: boolean\n  basePath: string\n  redirects: Array<Redirect>\n  rewrites: {\n    beforeFiles: Array<ManifestRewriteRoute>\n    afterFiles: Array<ManifestRewriteRoute>\n    fallback: Array<ManifestRewriteRoute>\n  }\n  headers: Array<ManifestHeaderRoute>\n  staticRoutes: Array<ManifestRoute>\n  dynamicRoutes: Array<ManifestRoute>\n  dataRoutes: Array<ManifestDataRoute>\n  i18n?: {\n    domains?: ReadonlyArray<{\n      http?: true\n      domain: string\n      locales?: readonly string[]\n      defaultLocale: string\n    }>\n    locales: readonly string[]\n    defaultLocale: string\n    localeDetection?: false\n  }\n  rsc: {\n    header: typeof RSC_HEADER\n    didPostponeHeader: typeof NEXT_DID_POSTPONE_HEADER\n    contentTypeHeader: typeof RSC_CONTENT_TYPE_HEADER\n    varyHeader: string\n    prefetchHeader: typeof NEXT_ROUTER_PREFETCH_HEADER\n    suffix: typeof RSC_SUFFIX\n    prefetchSuffix: typeof RSC_PREFETCH_SUFFIX\n    prefetchSegmentHeader: typeof NEXT_ROUTER_SEGMENT_PREFETCH_HEADER\n    prefetchSegmentDirSuffix: typeof RSC_SEGMENTS_DIR_SUFFIX\n    prefetchSegmentSuffix: typeof RSC_SEGMENT_SUFFIX\n  }\n  rewriteHeaders: {\n    pathHeader: typeof NEXT_REWRITTEN_PATH_HEADER\n    queryHeader: typeof NEXT_REWRITTEN_QUERY_HEADER\n  }\n  skipMiddlewareUrlNormalize?: boolean\n  caseSensitive?: boolean\n  /**\n   * Configuration related to Partial Prerendering.\n   */\n  ppr?: {\n    /**\n     * The chained response for the PPR resume.\n     */\n    chain: {\n      /**\n       * The headers that will indicate to Next.js that the request is for a PPR\n       * resume.\n       */\n      headers: Record<string, string>\n    }\n  }\n}\n\nfunction pageToRoute(page: string): ManifestRoute {\n  const routeRegex = getNamedRouteRegex(page, {\n    prefixRouteKeys: true,\n  })\n  return {\n    page,\n    regex: normalizeRouteRegex(routeRegex.re.source),\n    routeKeys: routeRegex.routeKeys,\n    namedRegex: routeRegex.namedRegex,\n  }\n}\n\nfunction getCacheDir(distDir: string): string {\n  const cacheDir = path.join(distDir, 'cache')\n  if (ciEnvironment.isCI && !ciEnvironment.hasNextSupport) {\n    const hasCache = existsSync(cacheDir)\n\n    if (!hasCache) {\n      // Intentionally not piping to stderr which is what `Log.warn` does in case people fail in CI when\n      // stderr is detected.\n      console.log(\n        `${Log.prefixes.warn} No build cache found. Please configure build caching for faster rebuilds. Read more: https://nextjs.org/docs/messages/no-cache`\n      )\n    }\n  }\n  return cacheDir\n}\n\nasync function writeFileUtf8(filePath: string, content: string): Promise<void> {\n  await fs.writeFile(filePath, content, 'utf-8')\n}\n\nfunction readFileUtf8(filePath: string): Promise<string> {\n  return fs.readFile(filePath, 'utf8')\n}\n\nasync function writeManifest<T extends object>(\n  filePath: string,\n  manifest: T\n): Promise<void> {\n  await writeFileUtf8(filePath, formatManifest(manifest))\n}\n\nasync function readManifest<T extends object>(filePath: string): Promise<T> {\n  return JSON.parse(await readFileUtf8(filePath))\n}\n\nasync function writePrerenderManifest(\n  distDir: string,\n  manifest: DeepReadonly<PrerenderManifest>\n): Promise<void> {\n  await writeManifest(path.join(distDir, PRERENDER_MANIFEST), manifest)\n}\n\nasync function writeClientSsgManifest(\n  prerenderManifest: DeepReadonly<PrerenderManifest>,\n  {\n    buildId,\n    distDir,\n    locales,\n  }: {\n    buildId: string\n    distDir: string\n    locales: readonly string[] | undefined\n  }\n) {\n  const ssgPages = new Set<string>(\n    [\n      ...Object.entries(prerenderManifest.routes)\n        // Filter out dynamic routes\n        .filter(([, { srcRoute }]) => srcRoute == null)\n        .map(([route]) => normalizeLocalePath(route, locales).pathname),\n      ...Object.keys(prerenderManifest.dynamicRoutes),\n    ].sort()\n  )\n\n  const clientSsgManifestContent = `self.__SSG_MANIFEST=${devalue(\n    ssgPages\n  )};self.__SSG_MANIFEST_CB&&self.__SSG_MANIFEST_CB()`\n\n  await writeFileUtf8(\n    path.join(distDir, CLIENT_STATIC_FILES_PATH, buildId, '_ssgManifest.js'),\n    clientSsgManifestContent\n  )\n}\n\nexport interface FunctionsConfigManifest {\n  version: number\n  functions: Record<\n    string,\n    {\n      maxDuration?: number | undefined\n      runtime?: 'nodejs'\n      matchers?: Array<{\n        regexp: string\n        originalSource: string\n        has?: Rewrite['has']\n        missing?: Rewrite['has']\n      }>\n    }\n  >\n}\n\nasync function writeFunctionsConfigManifest(\n  distDir: string,\n  manifest: FunctionsConfigManifest\n): Promise<void> {\n  await writeManifest(\n    path.join(distDir, SERVER_DIRECTORY, FUNCTIONS_CONFIG_MANIFEST),\n    manifest\n  )\n}\n\nexport interface RequiredServerFilesManifest {\n  version: number\n  config: NextConfigComplete\n  appDir: string\n  relativeAppDir: string\n  files: string[]\n  ignore: string[]\n}\n\nasync function writeRequiredServerFilesManifest(\n  distDir: string,\n  requiredServerFiles: RequiredServerFilesManifest\n) {\n  await writeManifest(\n    path.join(distDir, SERVER_FILES_MANIFEST),\n    requiredServerFiles\n  )\n}\n\nasync function writeImagesManifest(\n  distDir: string,\n  config: NextConfigComplete\n): Promise<void> {\n  const images = { ...config.images }\n  const { deviceSizes, imageSizes } = images\n  ;(images as any).sizes = [...deviceSizes, ...imageSizes]\n\n  // By default, remotePatterns will allow no remote images ([])\n  images.remotePatterns = (config?.images?.remotePatterns || []).map((p) => ({\n    // Modifying the manifest should also modify matchRemotePattern()\n    protocol: p.protocol?.replace(/:$/, '') as 'http' | 'https' | undefined,\n    hostname: makeRe(p.hostname).source,\n    port: p.port,\n    pathname: makeRe(p.pathname ?? '**', { dot: true }).source,\n    search: p.search,\n  }))\n\n  // By default, localPatterns will allow all local images (undefined)\n  if (config?.images?.localPatterns) {\n    images.localPatterns = config.images.localPatterns.map((p) => ({\n      // Modifying the manifest should also modify matchLocalPattern()\n      pathname: makeRe(p.pathname ?? '**', { dot: true }).source,\n      search: p.search,\n    }))\n  }\n\n  await writeManifest(path.join(distDir, IMAGES_MANIFEST), {\n    version: 1,\n    images,\n  })\n}\n\nconst STANDALONE_DIRECTORY = 'standalone' as const\nasync function writeStandaloneDirectory(\n  nextBuildSpan: Span,\n  distDir: string,\n  pageKeys: { pages: string[]; app: string[] | undefined },\n  denormalizedAppPages: string[] | undefined,\n  outputFileTracingRoot: string,\n  requiredServerFiles: RequiredServerFilesManifest,\n  middlewareManifest: MiddlewareManifest,\n  hasNodeMiddleware: boolean,\n  hasInstrumentationHook: boolean,\n  staticPages: Set<string>,\n  loadedEnvFiles: LoadedEnvFiles,\n  appDir: string | undefined\n) {\n  await nextBuildSpan\n    .traceChild('write-standalone-directory')\n    .traceAsyncFn(async () => {\n      await copyTracedFiles(\n        // requiredServerFiles.appDir Refers to the application directory, not App Router.\n        requiredServerFiles.appDir,\n        distDir,\n        pageKeys.pages,\n        denormalizedAppPages,\n        outputFileTracingRoot,\n        requiredServerFiles.config,\n        middlewareManifest,\n        hasNodeMiddleware,\n        hasInstrumentationHook,\n        staticPages\n      )\n\n      for (const file of [\n        ...requiredServerFiles.files,\n        path.join(requiredServerFiles.config.distDir, SERVER_FILES_MANIFEST),\n        ...loadedEnvFiles.reduce<string[]>((acc, envFile) => {\n          if (['.env', '.env.production'].includes(envFile.path)) {\n            acc.push(envFile.path)\n          }\n          return acc\n        }, []),\n      ]) {\n        // requiredServerFiles.appDir Refers to the application directory, not App Router.\n        const filePath = path.join(requiredServerFiles.appDir, file)\n        const outputPath = path.join(\n          distDir,\n          STANDALONE_DIRECTORY,\n          path.relative(outputFileTracingRoot, filePath)\n        )\n        await fs.mkdir(path.dirname(outputPath), {\n          recursive: true,\n        })\n        await fs.copyFile(filePath, outputPath)\n      }\n\n      if (hasNodeMiddleware) {\n        const middlewareOutput = path.join(\n          distDir,\n          STANDALONE_DIRECTORY,\n          path.relative(outputFileTracingRoot, distDir),\n          SERVER_DIRECTORY,\n          'middleware.js'\n        )\n\n        await fs.mkdir(path.dirname(middlewareOutput), { recursive: true })\n        await fs.copyFile(\n          path.join(distDir, SERVER_DIRECTORY, 'middleware.js'),\n          middlewareOutput\n        )\n      }\n\n      await recursiveCopy(\n        path.join(distDir, SERVER_DIRECTORY, 'pages'),\n        path.join(\n          distDir,\n          STANDALONE_DIRECTORY,\n          path.relative(outputFileTracingRoot, distDir),\n          SERVER_DIRECTORY,\n          'pages'\n        ),\n        { overwrite: true }\n      )\n      if (appDir) {\n        const originalServerApp = path.join(distDir, SERVER_DIRECTORY, 'app')\n        if (existsSync(originalServerApp)) {\n          await recursiveCopy(\n            originalServerApp,\n            path.join(\n              distDir,\n              STANDALONE_DIRECTORY,\n              path.relative(outputFileTracingRoot, distDir),\n              SERVER_DIRECTORY,\n              'app'\n            ),\n            { overwrite: true }\n          )\n        }\n      }\n    })\n}\n\nfunction getNumberOfWorkers(config: NextConfigComplete) {\n  if (\n    config.experimental.cpus &&\n    config.experimental.cpus !== defaultConfig.experimental!.cpus\n  ) {\n    return config.experimental.cpus\n  }\n\n  if (config.experimental.memoryBasedWorkersCount) {\n    return Math.max(\n      Math.min(config.experimental.cpus || 1, Math.floor(os.freemem() / 1e9)),\n      // enforce a minimum of 4 workers\n      4\n    )\n  }\n\n  if (config.experimental.cpus) {\n    return config.experimental.cpus\n  }\n\n  // Fall back to 4 workers if a count is not specified\n  return 4\n}\n\nconst staticWorkerPath = require.resolve('./worker')\nconst staticWorkerExposedMethods = [\n  'hasCustomGetInitialProps',\n  'isPageStatic',\n  'getDefinedNamedExports',\n  'exportPages',\n] as const\ntype StaticWorker = typeof import('./worker') & Worker\nexport function createStaticWorker(\n  config: NextConfigComplete,\n  options: {\n    debuggerPortOffset: number\n    progress?: {\n      run: () => void\n      clear: () => void\n    }\n  }\n): StaticWorker {\n  const { debuggerPortOffset, progress } = options\n  return new Worker(staticWorkerPath, {\n    logger: Log,\n    numWorkers: getNumberOfWorkers(config),\n    onActivity: () => {\n      progress?.run()\n    },\n    onActivityAbort: () => {\n      progress?.clear()\n    },\n    debuggerPortOffset,\n    enableSourceMaps: config.experimental.enablePrerenderSourceMaps,\n    // remove --max-old-space-size flag as it can cause memory issues.\n    isolatedMemory: true,\n    enableWorkerThreads: config.experimental.workerThreads,\n    exposedMethods: staticWorkerExposedMethods,\n  }) as StaticWorker\n}\n\nasync function writeFullyStaticExport(\n  config: NextConfigComplete,\n  dir: string,\n  enabledDirectories: NextEnabledDirectories,\n  configOutDir: string,\n  nextBuildSpan: Span\n): Promise<void> {\n  const exportApp = require('../export')\n    .default as typeof import('../export').default\n\n  await exportApp(\n    dir,\n    {\n      buildExport: false,\n      nextConfig: config,\n      enabledDirectories,\n      silent: true,\n      outdir: path.join(dir, configOutDir),\n      numWorkers: getNumberOfWorkers(config),\n    },\n    nextBuildSpan\n  )\n}\n\nasync function getBuildId(\n  isGenerateMode: boolean,\n  distDir: string,\n  nextBuildSpan: Span,\n  config: NextConfigComplete\n) {\n  if (isGenerateMode) {\n    return await fs.readFile(path.join(distDir, 'BUILD_ID'), 'utf8')\n  }\n  return await nextBuildSpan\n    .traceChild('generate-buildid')\n    .traceAsyncFn(() => generateBuildId(config.generateBuildId, nanoid))\n}\n\nexport default async function build(\n  dir: string,\n  reactProductionProfiling = false,\n  debugOutput = false,\n  runLint = true,\n  noMangling = false,\n  appDirOnly = false,\n  isTurbopack = false,\n  experimentalBuildMode: 'default' | 'compile' | 'generate' | 'generate-env',\n  traceUploadUrl: string | undefined\n): Promise<void> {\n  const isCompileMode = experimentalBuildMode === 'compile'\n  const isGenerateMode = experimentalBuildMode === 'generate'\n  NextBuildContext.isCompileMode = isCompileMode\n  const buildStartTime = Date.now()\n\n  let loadedConfig: NextConfigComplete | undefined\n  try {\n    const nextBuildSpan = trace('next-build', undefined, {\n      buildMode: experimentalBuildMode,\n      isTurboBuild: String(isTurbopack),\n      version: process.env.__NEXT_VERSION as string,\n    })\n\n    NextBuildContext.nextBuildSpan = nextBuildSpan\n    NextBuildContext.dir = dir\n    NextBuildContext.appDirOnly = appDirOnly\n    NextBuildContext.reactProductionProfiling = reactProductionProfiling\n    NextBuildContext.noMangling = noMangling\n\n    await nextBuildSpan.traceAsyncFn(async () => {\n      // attempt to load global env values so they are available in next.config.js\n      const { loadedEnvFiles } = nextBuildSpan\n        .traceChild('load-dotenv')\n        .traceFn(() => loadEnvConfig(dir, false, Log))\n      NextBuildContext.loadedEnvFiles = loadedEnvFiles\n\n      const turborepoAccessTraceResult = new TurborepoAccessTraceResult()\n      const config: NextConfigComplete = await nextBuildSpan\n        .traceChild('load-next-config')\n        .traceAsyncFn(() =>\n          turborepoTraceAccess(\n            () =>\n              loadConfig(PHASE_PRODUCTION_BUILD, dir, {\n                // Log for next.config loading process\n                silent: false,\n                reactProductionProfiling,\n              }),\n            turborepoAccessTraceResult\n          )\n        )\n      loadedConfig = config\n\n      process.env.NEXT_DEPLOYMENT_ID = config.deploymentId || ''\n      NextBuildContext.config = config\n\n      let configOutDir = 'out'\n      if (hasCustomExportOutput(config)) {\n        configOutDir = config.distDir\n        config.distDir = '.next'\n      }\n      const distDir = path.join(dir, config.distDir)\n      NextBuildContext.distDir = distDir\n      setGlobal('phase', PHASE_PRODUCTION_BUILD)\n      setGlobal('distDir', distDir)\n\n      const buildId = await getBuildId(\n        isGenerateMode,\n        distDir,\n        nextBuildSpan,\n        config\n      )\n      NextBuildContext.buildId = buildId\n\n      if (experimentalBuildMode === 'generate-env') {\n        if (isTurbopack) {\n          Log.warn('generate-env is not needed with turbopack')\n          process.exit(0)\n        }\n        Log.info('Inlining static env ...')\n        await nextBuildSpan\n          .traceChild('inline-static-env')\n          .traceAsyncFn(async () => {\n            await inlineStaticEnv({\n              distDir,\n              config,\n            })\n          })\n\n        Log.info('Complete')\n        await flushAllTraces()\n        teardownTraceSubscriber()\n        process.exit(0)\n      }\n\n      // when using compile mode static env isn't inlined so we\n      // need to populate in normal runtime env\n      if (isCompileMode || isGenerateMode) {\n        populateStaticEnv(config)\n      }\n\n      const customRoutes: CustomRoutes = await nextBuildSpan\n        .traceChild('load-custom-routes')\n        .traceAsyncFn(() => loadCustomRoutes(config))\n\n      const { headers, rewrites, redirects } = customRoutes\n      const combinedRewrites: Rewrite[] = [\n        ...rewrites.beforeFiles,\n        ...rewrites.afterFiles,\n        ...rewrites.fallback,\n      ]\n      const hasRewrites = combinedRewrites.length > 0\n      NextBuildContext.hasRewrites = hasRewrites\n      NextBuildContext.originalRewrites = config._originalRewrites\n      NextBuildContext.originalRedirects = config._originalRedirects\n\n      const cacheDir = getCacheDir(distDir)\n\n      const telemetry = new Telemetry({ distDir })\n\n      setGlobal('telemetry', telemetry)\n\n      const publicDir = path.join(dir, 'public')\n      const { pagesDir, appDir } = findPagesDir(dir)\n      NextBuildContext.pagesDir = pagesDir\n      NextBuildContext.appDir = appDir\n\n      const enabledDirectories: NextEnabledDirectories = {\n        app: typeof appDir === 'string',\n        pages: typeof pagesDir === 'string',\n      }\n\n      // Generate a random encryption key for this build.\n      // This key is used to encrypt cross boundary values and can be used to generate hashes.\n      const encryptionKey = await generateEncryptionKeyBase64({\n        isBuild: true,\n        distDir,\n      })\n      NextBuildContext.encryptionKey = encryptionKey\n\n      const isSrcDir = path\n        .relative(dir, pagesDir || appDir || '')\n        .startsWith('src')\n      const hasPublicDir = existsSync(publicDir)\n\n      telemetry.record(\n        eventCliSession(dir, config, {\n          webpackVersion: 5,\n          cliCommand: 'build',\n          isSrcDir,\n          hasNowJson: !!(await findUp('now.json', { cwd: dir })),\n          isCustomServer: null,\n          turboFlag: false,\n          pagesDir: !!pagesDir,\n          appDir: !!appDir,\n        })\n      )\n\n      eventNextPlugins(path.resolve(dir)).then((events) =>\n        telemetry.record(events)\n      )\n\n      eventSwcPlugins(path.resolve(dir), config).then((events) =>\n        telemetry.record(events)\n      )\n\n      // Always log next version first then start rest jobs\n      const { envInfo, experimentalFeatures } = await getStartServerInfo(\n        dir,\n        false\n      )\n      logStartInfo({\n        networkUrl: null,\n        appUrl: null,\n        envInfo,\n        experimentalFeatures,\n      })\n\n      const ignoreESLint = Boolean(config.eslint.ignoreDuringBuilds)\n      const shouldLint = !ignoreESLint && runLint\n\n      const typeCheckingOptions: Parameters<typeof startTypeChecking>[0] = {\n        dir,\n        appDir,\n        pagesDir,\n        runLint,\n        shouldLint,\n        ignoreESLint,\n        telemetry,\n        nextBuildSpan,\n        config,\n        cacheDir,\n      }\n\n      const distDirCreated = await nextBuildSpan\n        .traceChild('create-dist-dir')\n        .traceAsyncFn(async () => {\n          try {\n            await fs.mkdir(distDir, { recursive: true })\n            return true\n          } catch (err) {\n            if (isError(err) && err.code === 'EPERM') {\n              return false\n            }\n            throw err\n          }\n        })\n\n      if (!distDirCreated || !(await isWriteable(distDir))) {\n        throw new Error(\n          '> Build directory is not writeable. https://nextjs.org/docs/messages/build-dir-not-writeable'\n        )\n      }\n\n      if (config.cleanDistDir && !isGenerateMode) {\n        await recursiveDelete(distDir, /^cache/)\n      }\n\n      // For app directory, we run type checking after build. That's because\n      // we dynamically generate types for each layout and page in the app\n      // directory.\n      if (!appDir && !isCompileMode)\n        await startTypeChecking(typeCheckingOptions)\n\n      if (appDir && 'exportPathMap' in config) {\n        Log.error(\n          'The \"exportPathMap\" configuration cannot be used with the \"app\" directory. Please use generateStaticParams() instead.'\n        )\n        await telemetry.flush()\n        process.exit(1)\n      }\n\n      const buildLintEvent: EventBuildFeatureUsage = {\n        featureName: 'build-lint',\n        invocationCount: shouldLint ? 1 : 0,\n      }\n      telemetry.record({\n        eventName: EVENT_BUILD_FEATURE_USAGE,\n        payload: buildLintEvent,\n      })\n\n      const validFileMatcher = createValidFileMatcher(\n        config.pageExtensions,\n        appDir\n      )\n\n      const providedPagePaths: string[] = JSON.parse(\n        process.env.NEXT_PRIVATE_PAGE_PATHS || '[]'\n      )\n\n      let pagesPaths = Boolean(process.env.NEXT_PRIVATE_PAGE_PATHS)\n        ? providedPagePaths\n        : !appDirOnly && pagesDir\n          ? await nextBuildSpan.traceChild('collect-pages').traceAsyncFn(() =>\n              recursiveReadDir(pagesDir, {\n                pathnameFilter: validFileMatcher.isPageFile,\n              })\n            )\n          : []\n\n      const middlewareDetectionRegExp = new RegExp(\n        `^${MIDDLEWARE_FILENAME}\\\\.(?:${config.pageExtensions.join('|')})$`\n      )\n\n      const instrumentationHookDetectionRegExp = new RegExp(\n        `^${INSTRUMENTATION_HOOK_FILENAME}\\\\.(?:${config.pageExtensions.join(\n          '|'\n        )})$`\n      )\n\n      const rootDir = path.join((pagesDir || appDir)!, '..')\n      const includes = [\n        middlewareDetectionRegExp,\n        instrumentationHookDetectionRegExp,\n      ]\n\n      const rootPaths = Array.from(await getFilesInDir(rootDir))\n        .filter((file) => includes.some((include) => include.test(file)))\n        .sort(sortByPageExts(config.pageExtensions))\n        .map((file) => path.join(rootDir, file).replace(dir, ''))\n\n      const hasInstrumentationHook = rootPaths.some((p) =>\n        p.includes(INSTRUMENTATION_HOOK_FILENAME)\n      )\n      const hasMiddlewareFile = rootPaths.some((p) =>\n        p.includes(MIDDLEWARE_FILENAME)\n      )\n\n      NextBuildContext.hasInstrumentationHook = hasInstrumentationHook\n\n      const previewProps: __ApiPreviewProps = {\n        previewModeId: crypto.randomBytes(16).toString('hex'),\n        previewModeSigningKey: crypto.randomBytes(32).toString('hex'),\n        previewModeEncryptionKey: crypto.randomBytes(32).toString('hex'),\n      }\n      NextBuildContext.previewProps = previewProps\n\n      const mappedPages = await nextBuildSpan\n        .traceChild('create-pages-mapping')\n        .traceAsyncFn(() =>\n          createPagesMapping({\n            isDev: false,\n            pageExtensions: config.pageExtensions,\n            pagesType: PAGE_TYPES.PAGES,\n            pagePaths: pagesPaths,\n            pagesDir,\n            appDir,\n          })\n        )\n      NextBuildContext.mappedPages = mappedPages\n\n      let mappedAppPages: MappedPages | undefined\n      let denormalizedAppPages: string[] | undefined\n\n      if (appDir) {\n        const providedAppPaths: string[] = JSON.parse(\n          process.env.NEXT_PRIVATE_APP_PATHS || '[]'\n        )\n\n        let appPaths = Boolean(process.env.NEXT_PRIVATE_APP_PATHS)\n          ? providedAppPaths\n          : await nextBuildSpan\n              .traceChild('collect-app-paths')\n              .traceAsyncFn(() =>\n                recursiveReadDir(appDir, {\n                  pathnameFilter: (absolutePath) =>\n                    validFileMatcher.isAppRouterPage(absolutePath) ||\n                    // For now we only collect the root /not-found page in the app\n                    // directory as the 404 fallback\n                    validFileMatcher.isRootNotFound(absolutePath),\n                  ignorePartFilter: (part) => part.startsWith('_'),\n                })\n              )\n\n        mappedAppPages = await nextBuildSpan\n          .traceChild('create-app-mapping')\n          .traceAsyncFn(() =>\n            createPagesMapping({\n              pagePaths: appPaths,\n              isDev: false,\n              pagesType: PAGE_TYPES.APP,\n              pageExtensions: config.pageExtensions,\n              pagesDir,\n              appDir,\n            })\n          )\n\n        NextBuildContext.mappedAppPages = mappedAppPages\n      }\n\n      const mappedRootPaths = await createPagesMapping({\n        isDev: false,\n        pageExtensions: config.pageExtensions,\n        pagePaths: rootPaths,\n        pagesType: PAGE_TYPES.ROOT,\n        pagesDir: pagesDir,\n        appDir,\n      })\n      NextBuildContext.mappedRootPaths = mappedRootPaths\n\n      const pagesPageKeys = Object.keys(mappedPages)\n\n      const conflictingAppPagePaths: [pagePath: string, appPath: string][] = []\n      const appPageKeys = new Set<string>()\n      if (mappedAppPages) {\n        denormalizedAppPages = Object.keys(mappedAppPages)\n        for (const appKey of denormalizedAppPages) {\n          const normalizedAppPageKey = normalizeAppPath(appKey)\n          const pagePath = mappedPages[normalizedAppPageKey]\n          if (pagePath) {\n            const appPath = mappedAppPages[appKey]\n            conflictingAppPagePaths.push([\n              pagePath.replace(/^private-next-pages/, 'pages'),\n              appPath.replace(/^private-next-app-dir/, 'app'),\n            ])\n          }\n          appPageKeys.add(normalizedAppPageKey)\n        }\n      }\n\n      const appPaths = Array.from(appPageKeys)\n      // Interception routes are modelled as beforeFiles rewrites\n      rewrites.beforeFiles.push(\n        ...generateInterceptionRoutesRewrites(appPaths, config.basePath)\n      )\n\n      NextBuildContext.rewrites = rewrites\n\n      const totalAppPagesCount = appPaths.length\n\n      const pageKeys = {\n        pages: pagesPageKeys,\n        app: appPaths.length > 0 ? appPaths : undefined,\n      }\n\n      // Turbopack already handles conflicting app and page routes.\n      if (!isTurbopack) {\n        const numConflictingAppPaths = conflictingAppPagePaths.length\n        if (mappedAppPages && numConflictingAppPaths > 0) {\n          Log.error(\n            `Conflicting app and page file${\n              numConflictingAppPaths === 1 ? ' was' : 's were'\n            } found, please remove the conflicting files to continue:`\n          )\n          for (const [pagePath, appPath] of conflictingAppPagePaths) {\n            Log.error(`  \"${pagePath}\" - \"${appPath}\"`)\n          }\n          await telemetry.flush()\n          process.exit(1)\n        }\n      }\n\n      const conflictingPublicFiles: string[] = []\n      const hasPages404 = mappedPages['/404']?.startsWith(PAGES_DIR_ALIAS)\n      const hasApp404 = !!mappedAppPages?.[UNDERSCORE_NOT_FOUND_ROUTE_ENTRY]\n      const hasCustomErrorPage =\n        mappedPages['/_error'].startsWith(PAGES_DIR_ALIAS)\n\n      if (hasPublicDir) {\n        const hasPublicUnderScoreNextDir = existsSync(\n          path.join(publicDir, '_next')\n        )\n        if (hasPublicUnderScoreNextDir) {\n          throw new Error(PUBLIC_DIR_MIDDLEWARE_CONFLICT)\n        }\n      }\n\n      await nextBuildSpan\n        .traceChild('public-dir-conflict-check')\n        .traceAsyncFn(async () => {\n          // Check if pages conflict with files in `public`\n          // Only a page of public file can be served, not both.\n          for (const page in mappedPages) {\n            const hasPublicPageFile = await fileExists(\n              path.join(publicDir, page === '/' ? '/index' : page),\n              FileType.File\n            )\n            if (hasPublicPageFile) {\n              conflictingPublicFiles.push(page)\n            }\n          }\n\n          const numConflicting = conflictingPublicFiles.length\n\n          if (numConflicting) {\n            throw new Error(\n              `Conflicting public and page file${\n                numConflicting === 1 ? ' was' : 's were'\n              } found. https://nextjs.org/docs/messages/conflicting-public-file-page\\n${conflictingPublicFiles.join(\n                '\\n'\n              )}`\n            )\n          }\n        })\n\n      const nestedReservedPages = pageKeys.pages.filter((page) => {\n        return (\n          page.match(/\\/(_app|_document|_error)$/) && path.dirname(page) !== '/'\n        )\n      })\n\n      if (nestedReservedPages.length) {\n        Log.warn(\n          `The following reserved Next.js pages were detected not directly under the pages directory:\\n` +\n            nestedReservedPages.join('\\n') +\n            `\\nSee more info here: https://nextjs.org/docs/messages/nested-reserved-page\\n`\n        )\n      }\n\n      const restrictedRedirectPaths = ['/_next'].map((p) =>\n        config.basePath ? `${config.basePath}${p}` : p\n      )\n\n      const isAppDynamicIOEnabled = Boolean(config.experimental.dynamicIO)\n      const isAuthInterruptsEnabled = Boolean(\n        config.experimental.authInterrupts\n      )\n      const isAppPPREnabled = checkIsAppPPREnabled(config.experimental.ppr)\n\n      const routesManifestPath = path.join(distDir, ROUTES_MANIFEST)\n      const routesManifest: RoutesManifest = nextBuildSpan\n        .traceChild('generate-routes-manifest')\n        .traceFn(() => {\n          const sortedRoutes = getSortedRoutes([\n            ...pageKeys.pages,\n            ...(pageKeys.app ?? []),\n          ])\n          const dynamicRoutes: Array<ManifestRoute> = []\n          const staticRoutes: Array<ManifestRoute> = []\n\n          for (const route of sortedRoutes) {\n            if (isDynamicRoute(route)) {\n              dynamicRoutes.push(pageToRoute(route))\n            } else if (!isReservedPage(route)) {\n              staticRoutes.push(pageToRoute(route))\n            }\n          }\n\n          return {\n            version: 3,\n            pages404: true,\n            caseSensitive: !!config.experimental.caseSensitiveRoutes,\n            basePath: config.basePath,\n            redirects: redirects.map((r) =>\n              buildCustomRoute('redirect', r, restrictedRedirectPaths)\n            ),\n            headers: headers.map((r) => buildCustomRoute('header', r)),\n            rewrites: {\n              beforeFiles: [],\n              afterFiles: [],\n              fallback: [],\n            },\n            dynamicRoutes,\n            staticRoutes,\n            dataRoutes: [],\n            i18n: config.i18n || undefined,\n            rsc: {\n              header: RSC_HEADER,\n              // This vary header is used as a default. It is technically re-assigned in `base-server`,\n              // and may include an additional Vary option for `Next-URL`.\n              varyHeader: `${RSC_HEADER}, ${NEXT_ROUTER_STATE_TREE_HEADER}, ${NEXT_ROUTER_PREFETCH_HEADER}, ${NEXT_ROUTER_SEGMENT_PREFETCH_HEADER}`,\n              prefetchHeader: NEXT_ROUTER_PREFETCH_HEADER,\n              didPostponeHeader: NEXT_DID_POSTPONE_HEADER,\n              contentTypeHeader: RSC_CONTENT_TYPE_HEADER,\n              suffix: RSC_SUFFIX,\n              prefetchSuffix: RSC_PREFETCH_SUFFIX,\n              prefetchSegmentHeader: NEXT_ROUTER_SEGMENT_PREFETCH_HEADER,\n              prefetchSegmentSuffix: RSC_SEGMENT_SUFFIX,\n              prefetchSegmentDirSuffix: RSC_SEGMENTS_DIR_SUFFIX,\n            },\n            rewriteHeaders: {\n              pathHeader: NEXT_REWRITTEN_PATH_HEADER,\n              queryHeader: NEXT_REWRITTEN_QUERY_HEADER,\n            },\n            skipMiddlewareUrlNormalize: config.skipMiddlewareUrlNormalize,\n            ppr: isAppPPREnabled\n              ? {\n                  chain: {\n                    headers: {\n                      [NEXT_RESUME_HEADER]: '1',\n                    },\n                  },\n                }\n              : undefined,\n          } satisfies RoutesManifest\n        })\n\n      routesManifest.rewrites = {\n        beforeFiles: rewrites.beforeFiles.map((r) =>\n          buildCustomRoute('rewrite', r)\n        ),\n        afterFiles: rewrites.afterFiles.map((r) =>\n          buildCustomRoute('rewrite', r)\n        ),\n        fallback: rewrites.fallback.map((r) => buildCustomRoute('rewrite', r)),\n      }\n\n      let clientRouterFilters:\n        | undefined\n        | ReturnType<typeof createClientRouterFilter>\n\n      if (config.experimental.clientRouterFilter) {\n        const nonInternalRedirects = (config._originalRedirects || []).filter(\n          (r: any) => !r.internal\n        )\n        clientRouterFilters = createClientRouterFilter(\n          [...appPaths],\n          config.experimental.clientRouterFilterRedirects\n            ? nonInternalRedirects\n            : [],\n          config.experimental.clientRouterFilterAllowedRate\n        )\n        NextBuildContext.clientRouterFilters = clientRouterFilters\n      }\n\n      // Ensure commonjs handling is used for files in the distDir (generally .next)\n      // Files outside of the distDir can be \"type\": \"module\"\n      await writeFileUtf8(\n        path.join(distDir, 'package.json'),\n        '{\"type\": \"commonjs\"}'\n      )\n\n      // These are written to distDir, so they need to come after creating and cleaning distDr.\n      await recordFrameworkVersion(process.env.__NEXT_VERSION as string)\n      await updateBuildDiagnostics({\n        buildStage: 'start',\n      })\n\n      const outputFileTracingRoot = config.outputFileTracingRoot || dir\n\n      const pagesManifestPath = path.join(\n        distDir,\n        SERVER_DIRECTORY,\n        PAGES_MANIFEST\n      )\n\n      let buildTraceContext: undefined | BuildTraceContext\n      let buildTracesPromise: Promise<any> | undefined = undefined\n\n      // If there's has a custom webpack config and disable the build worker.\n      // Otherwise respect the option if it's set.\n      const useBuildWorker =\n        config.experimental.webpackBuildWorker ||\n        (config.experimental.webpackBuildWorker === undefined &&\n          !config.webpack)\n      const runServerAndEdgeInParallel =\n        config.experimental.parallelServerCompiles\n      const collectServerBuildTracesInParallel =\n        config.experimental.parallelServerBuildTraces ||\n        (config.experimental.parallelServerBuildTraces === undefined &&\n          isCompileMode)\n\n      nextBuildSpan.setAttribute(\n        'has-custom-webpack-config',\n        String(!!config.webpack)\n      )\n      nextBuildSpan.setAttribute('use-build-worker', String(useBuildWorker))\n\n      if (\n        !useBuildWorker &&\n        (runServerAndEdgeInParallel || collectServerBuildTracesInParallel)\n      ) {\n        throw new Error(\n          'The \"parallelServerBuildTraces\" and \"parallelServerCompiles\" options may only be used when build workers can be used. Read more: https://nextjs.org/docs/messages/parallel-build-without-worker'\n        )\n      }\n\n      Log.info('Creating an optimized production build ...')\n      traceMemoryUsage('Starting build', nextBuildSpan)\n\n      await updateBuildDiagnostics({\n        buildStage: 'compile',\n        buildOptions: {\n          useBuildWorker: String(useBuildWorker),\n        },\n      })\n\n      let shutdownPromise = Promise.resolve()\n      if (!isGenerateMode) {\n        if (isTurbopack) {\n          const {\n            duration: compilerDuration,\n            shutdownPromise: p,\n            ...rest\n          } = await turbopackBuild(\n            process.env.NEXT_TURBOPACK_USE_WORKER === undefined ||\n              process.env.NEXT_TURBOPACK_USE_WORKER !== '0'\n          )\n          shutdownPromise = p\n          traceMemoryUsage('Finished build', nextBuildSpan)\n\n          buildTraceContext = rest.buildTraceContext\n\n          const durationString = durationToString(compilerDuration)\n          Log.event(`Compiled successfully in ${durationString}`)\n\n          telemetry.record(\n            eventBuildCompleted(pagesPaths, {\n              bundler: 'turbopack',\n              durationInSeconds: Math.round(compilerDuration),\n              totalAppPagesCount,\n            })\n          )\n        } else {\n          if (\n            runServerAndEdgeInParallel ||\n            collectServerBuildTracesInParallel\n          ) {\n            let durationInSeconds = 0\n\n            await updateBuildDiagnostics({\n              buildStage: 'compile-server',\n            })\n\n            const serverBuildPromise = webpackBuild(useBuildWorker, [\n              'server',\n            ]).then((res) => {\n              traceMemoryUsage('Finished server compilation', nextBuildSpan)\n              buildTraceContext = res.buildTraceContext\n              durationInSeconds += res.duration\n\n              if (collectServerBuildTracesInParallel) {\n                const buildTraceWorker = new Worker(\n                  require.resolve('./collect-build-traces'),\n                  {\n                    debuggerPortOffset: -1,\n                    isolatedMemory: false,\n                    numWorkers: 1,\n                    exposedMethods: ['collectBuildTraces'],\n                  }\n                ) as Worker & typeof import('./collect-build-traces')\n\n                buildTracesPromise = buildTraceWorker\n                  .collectBuildTraces({\n                    dir,\n                    config,\n                    distDir,\n                    // Serialize Map as this is sent to the worker.\n                    edgeRuntimeRoutes: collectRoutesUsingEdgeRuntime(new Map()),\n                    staticPages: [],\n                    hasSsrAmpPages: false,\n                    buildTraceContext,\n                    outputFileTracingRoot,\n                    isTurbopack: false,\n                  })\n                  .catch((err) => {\n                    console.error(err)\n                    process.exit(1)\n                  })\n              }\n            })\n            if (!runServerAndEdgeInParallel) {\n              await serverBuildPromise\n              await updateBuildDiagnostics({\n                buildStage: 'webpack-compile-edge-server',\n              })\n            }\n\n            const edgeBuildPromise = webpackBuild(useBuildWorker, [\n              'edge-server',\n            ]).then((res) => {\n              durationInSeconds += res.duration\n              traceMemoryUsage(\n                'Finished edge-server compilation',\n                nextBuildSpan\n              )\n            })\n            if (runServerAndEdgeInParallel) {\n              await serverBuildPromise\n              await updateBuildDiagnostics({\n                buildStage: 'webpack-compile-edge-server',\n              })\n            }\n            await edgeBuildPromise\n\n            await updateBuildDiagnostics({\n              buildStage: 'webpack-compile-client',\n            })\n\n            await webpackBuild(useBuildWorker, ['client']).then((res) => {\n              durationInSeconds += res.duration\n              traceMemoryUsage('Finished client compilation', nextBuildSpan)\n            })\n\n            const durationString = durationToString(durationInSeconds)\n            Log.event(`Compiled successfully in ${durationString}`)\n\n            telemetry.record(\n              eventBuildCompleted(pagesPaths, {\n                bundler: getBundlerForTelemetry(isTurbopack),\n                durationInSeconds,\n                totalAppPagesCount,\n              })\n            )\n          } else {\n            const { duration: compilerDuration, ...rest } = await webpackBuild(\n              useBuildWorker,\n              null\n            )\n            traceMemoryUsage('Finished build', nextBuildSpan)\n\n            buildTraceContext = rest.buildTraceContext\n\n            telemetry.record(\n              eventBuildCompleted(pagesPaths, {\n                bundler: getBundlerForTelemetry(isTurbopack),\n                durationInSeconds: compilerDuration,\n                totalAppPagesCount,\n              })\n            )\n          }\n        }\n        await runAfterProductionCompile({\n          config,\n          buildSpan: nextBuildSpan,\n          telemetry,\n          metadata: {\n            projectDir: dir,\n            distDir,\n          },\n        })\n      }\n\n      // For app directory, we run type checking after build.\n      if (appDir && !isCompileMode && !isGenerateMode) {\n        await updateBuildDiagnostics({\n          buildStage: 'type-checking',\n        })\n        await startTypeChecking(typeCheckingOptions)\n        traceMemoryUsage('Finished type checking', nextBuildSpan)\n      }\n\n      const postCompileSpinner = createSpinner('Collecting page data')\n\n      const buildManifestPath = path.join(distDir, BUILD_MANIFEST)\n      const appBuildManifestPath = path.join(distDir, APP_BUILD_MANIFEST)\n\n      let staticAppPagesCount = 0\n      let serverAppPagesCount = 0\n      let edgeRuntimeAppCount = 0\n      let edgeRuntimePagesCount = 0\n      const ssgPages = new Set<string>()\n      const ssgStaticFallbackPages = new Set<string>()\n      const ssgBlockingFallbackPages = new Set<string>()\n      const staticPages = new Set<string>()\n      const invalidPages = new Set<string>()\n      const hybridAmpPages = new Set<string>()\n      const serverPropsPages = new Set<string>()\n      const additionalPaths = new Map<string, PrerenderedRoute[]>()\n      const staticPaths = new Map<string, PrerenderedRoute[]>()\n      const appNormalizedPaths = new Map<string, string>()\n      const fallbackModes = new Map<string, FallbackMode>()\n      const appDefaultConfigs = new Map<string, AppSegmentConfig>()\n      const pageInfos: PageInfos = new Map<string, PageInfo>()\n      let pagesManifest = await readManifest<PagesManifest>(pagesManifestPath)\n      const buildManifest = await readManifest<BuildManifest>(buildManifestPath)\n      const appBuildManifest = appDir\n        ? await readManifest<AppBuildManifest>(appBuildManifestPath)\n        : undefined\n\n      const appPathRoutes: Record<string, string> = {}\n\n      if (appDir) {\n        const appPathsManifest = await readManifest<Record<string, string>>(\n          path.join(distDir, SERVER_DIRECTORY, APP_PATHS_MANIFEST)\n        )\n\n        for (const key in appPathsManifest) {\n          appPathRoutes[key] = normalizeAppPath(key)\n        }\n\n        await writeManifest(\n          path.join(distDir, APP_PATH_ROUTES_MANIFEST),\n          appPathRoutes\n        )\n      }\n\n      process.env.NEXT_PHASE = PHASE_PRODUCTION_BUILD\n\n      const worker = createStaticWorker(config, { debuggerPortOffset: -1 })\n\n      const analysisBegin = process.hrtime()\n      const staticCheckSpan = nextBuildSpan.traceChild('static-check')\n\n      const functionsConfigManifest: FunctionsConfigManifest = {\n        version: 1,\n        functions: {},\n      }\n\n      const {\n        customAppGetInitialProps,\n        namedExports,\n        isNextImageImported,\n        hasSsrAmpPages,\n        hasNonStaticErrorPage,\n      } = await staticCheckSpan.traceAsyncFn(async () => {\n        if (isCompileMode) {\n          return {\n            customAppGetInitialProps: false,\n            namedExports: [],\n            isNextImageImported: true,\n            hasSsrAmpPages: !!pagesDir,\n            hasNonStaticErrorPage: true,\n          }\n        }\n\n        const { configFileName, publicRuntimeConfig, serverRuntimeConfig } =\n          config\n        const runtimeEnvConfig = { publicRuntimeConfig, serverRuntimeConfig }\n        const sriEnabled = Boolean(config.experimental.sri?.algorithm)\n\n        const nonStaticErrorPageSpan = staticCheckSpan.traceChild(\n          'check-static-error-page'\n        )\n        const errorPageHasCustomGetInitialProps =\n          nonStaticErrorPageSpan.traceAsyncFn(\n            async () =>\n              hasCustomErrorPage &&\n              (await worker.hasCustomGetInitialProps({\n                page: '/_error',\n                distDir,\n                runtimeEnvConfig,\n                checkingApp: false,\n                sriEnabled,\n              }))\n          )\n\n        const errorPageStaticResult = nonStaticErrorPageSpan.traceAsyncFn(\n          async () =>\n            hasCustomErrorPage &&\n            worker.isPageStatic({\n              dir,\n              page: '/_error',\n              distDir,\n              configFileName,\n              runtimeEnvConfig,\n              dynamicIO: isAppDynamicIOEnabled,\n              authInterrupts: isAuthInterruptsEnabled,\n              httpAgentOptions: config.httpAgentOptions,\n              locales: config.i18n?.locales,\n              defaultLocale: config.i18n?.defaultLocale,\n              nextConfigOutput: config.output,\n              pprConfig: config.experimental.ppr,\n              cacheLifeProfiles: config.experimental.cacheLife,\n              buildId,\n              sriEnabled,\n            })\n        )\n\n        const appPageToCheck = '/_app'\n\n        const customAppGetInitialPropsPromise = worker.hasCustomGetInitialProps(\n          {\n            page: appPageToCheck,\n            distDir,\n            runtimeEnvConfig,\n            checkingApp: true,\n            sriEnabled,\n          }\n        )\n\n        const namedExportsPromise = worker.getDefinedNamedExports({\n          page: appPageToCheck,\n          distDir,\n          runtimeEnvConfig,\n          sriEnabled,\n        })\n\n        // eslint-disable-next-line @typescript-eslint/no-shadow\n        let isNextImageImported: boolean | undefined\n        // eslint-disable-next-line @typescript-eslint/no-shadow\n        let hasSsrAmpPages = false\n\n        const computedManifestData = await computeFromManifest(\n          { build: buildManifest, app: appBuildManifest },\n          distDir,\n          config.experimental.gzipSize\n        )\n\n        const middlewareManifest: MiddlewareManifest = require(\n          path.join(distDir, SERVER_DIRECTORY, MIDDLEWARE_MANIFEST)\n        )\n\n        const actionManifest = appDir\n          ? (require(\n              path.join(\n                distDir,\n                SERVER_DIRECTORY,\n                SERVER_REFERENCE_MANIFEST + '.json'\n              )\n            ) as ActionManifest)\n          : null\n        const entriesWithAction = actionManifest ? new Set() : null\n        if (actionManifest && entriesWithAction) {\n          for (const id in actionManifest.node) {\n            for (const entry in actionManifest.node[id].workers) {\n              entriesWithAction.add(entry)\n            }\n          }\n          for (const id in actionManifest.edge) {\n            for (const entry in actionManifest.edge[id].workers) {\n              entriesWithAction.add(entry)\n            }\n          }\n        }\n\n        for (const key of Object.keys(middlewareManifest?.functions)) {\n          if (key.startsWith('/api')) {\n            edgeRuntimePagesCount++\n          }\n        }\n\n        await Promise.all(\n          Object.entries(pageKeys)\n            .reduce<Array<{ pageType: keyof typeof pageKeys; page: string }>>(\n              (acc, [key, files]) => {\n                if (!files) {\n                  return acc\n                }\n\n                const pageType = key as keyof typeof pageKeys\n\n                for (const page of files) {\n                  acc.push({ pageType, page })\n                }\n\n                return acc\n              },\n              []\n            )\n            .map(({ pageType, page }) => {\n              const checkPageSpan = staticCheckSpan.traceChild('check-page', {\n                page,\n              })\n              return checkPageSpan.traceAsyncFn(async () => {\n                const actualPage = normalizePagePath(page)\n                const [size, totalSize] = await getJsPageSizeInKb(\n                  pageType,\n                  actualPage,\n                  distDir,\n                  buildManifest,\n                  appBuildManifest,\n                  config.experimental.gzipSize,\n                  computedManifestData\n                )\n\n                let isRoutePPREnabled = false\n                let isSSG = false\n                let isStatic = false\n                let isServerComponent = false\n                let isHybridAmp = false\n                let ssgPageRoutes: string[] | null = null\n                let pagePath = ''\n\n                if (pageType === 'pages') {\n                  pagePath =\n                    pagesPaths.find((p) => {\n                      p = normalizePathSep(p)\n                      return (\n                        p.startsWith(actualPage + '.') ||\n                        p.startsWith(actualPage + '/index.')\n                      )\n                    }) || ''\n                }\n                let originalAppPath: string | undefined\n\n                if (pageType === 'app' && mappedAppPages) {\n                  for (const [originalPath, normalizedPath] of Object.entries(\n                    appPathRoutes\n                  )) {\n                    if (normalizedPath === page) {\n                      pagePath = mappedAppPages[originalPath].replace(\n                        /^private-next-app-dir/,\n                        ''\n                      )\n                      originalAppPath = originalPath\n                      break\n                    }\n                  }\n                }\n\n                const pageFilePath = isAppBuiltinNotFoundPage(pagePath)\n                  ? require.resolve(\n                      'next/dist/client/components/not-found-error'\n                    )\n                  : path.join(\n                      (pageType === 'pages' ? pagesDir : appDir) || '',\n                      pagePath\n                    )\n\n                const isInsideAppDir = pageType === 'app'\n                const staticInfo = pagePath\n                  ? await getStaticInfoIncludingLayouts({\n                      isInsideAppDir,\n                      pageFilePath,\n                      pageExtensions: config.pageExtensions,\n                      appDir,\n                      config,\n                      isDev: false,\n                      // If this route is an App Router page route, inherit the\n                      // route segment configs (e.g. `runtime`) from the layout by\n                      // passing the `originalAppPath`, which should end with `/page`.\n                      page: isInsideAppDir ? originalAppPath! : page,\n                    })\n                  : undefined\n\n                // If there's any thing that would contribute to the functions\n                // configuration, we need to add it to the manifest.\n                if (\n                  typeof staticInfo?.runtime !== 'undefined' ||\n                  typeof staticInfo?.maxDuration !== 'undefined'\n                ) {\n                  functionsConfigManifest.functions[page] = {\n                    maxDuration: staticInfo?.maxDuration,\n                  }\n                }\n\n                const pageRuntime = middlewareManifest.functions[\n                  originalAppPath || page\n                ]\n                  ? 'edge'\n                  : staticInfo?.runtime\n\n                if (!isCompileMode) {\n                  isServerComponent =\n                    pageType === 'app' &&\n                    staticInfo?.rsc !== RSC_MODULE_TYPES.client\n\n                  if (pageType === 'app' || !isReservedPage(page)) {\n                    try {\n                      let edgeInfo: any\n\n                      if (isEdgeRuntime(pageRuntime)) {\n                        if (pageType === 'app') {\n                          edgeRuntimeAppCount++\n                        } else {\n                          edgeRuntimePagesCount++\n                        }\n\n                        const manifestKey =\n                          pageType === 'pages' ? page : originalAppPath || ''\n\n                        edgeInfo = middlewareManifest.functions[manifestKey]\n                      }\n\n                      let isPageStaticSpan =\n                        checkPageSpan.traceChild('is-page-static')\n                      let workerResult = await isPageStaticSpan.traceAsyncFn(\n                        () => {\n                          return worker.isPageStatic({\n                            dir,\n                            page,\n                            originalAppPath,\n                            distDir,\n                            configFileName,\n                            runtimeEnvConfig,\n                            httpAgentOptions: config.httpAgentOptions,\n                            locales: config.i18n?.locales,\n                            defaultLocale: config.i18n?.defaultLocale,\n                            parentId: isPageStaticSpan.getId(),\n                            pageRuntime,\n                            edgeInfo,\n                            pageType,\n                            dynamicIO: isAppDynamicIOEnabled,\n                            authInterrupts: isAuthInterruptsEnabled,\n                            cacheHandler: config.cacheHandler,\n                            cacheHandlers: config.experimental.cacheHandlers,\n                            isrFlushToDisk: ciEnvironment.hasNextSupport\n                              ? false\n                              : config.experimental.isrFlushToDisk,\n                            maxMemoryCacheSize: config.cacheMaxMemorySize,\n                            nextConfigOutput: config.output,\n                            pprConfig: config.experimental.ppr,\n                            cacheLifeProfiles: config.experimental.cacheLife,\n                            buildId,\n                            sriEnabled,\n                          })\n                        }\n                      )\n\n                      if (pageType === 'app' && originalAppPath) {\n                        appNormalizedPaths.set(originalAppPath, page)\n                        // TODO-APP: handle prerendering with edge\n                        if (isEdgeRuntime(pageRuntime)) {\n                          isStatic = false\n                          isSSG = false\n\n                          Log.warnOnce(\n                            `Using edge runtime on a page currently disables static generation for that page`\n                          )\n                        } else {\n                          const isDynamic = isDynamicRoute(page)\n\n                          if (\n                            typeof workerResult.isRoutePPREnabled === 'boolean'\n                          ) {\n                            isRoutePPREnabled = workerResult.isRoutePPREnabled\n                          }\n\n                          // If this route can be partially pre-rendered, then\n                          // mark it as such and mark that it can be\n                          // generated server-side.\n                          if (workerResult.isRoutePPREnabled) {\n                            isSSG = true\n                            isStatic = true\n\n                            staticPaths.set(originalAppPath, [])\n                          }\n\n                          if (workerResult.prerenderedRoutes) {\n                            staticPaths.set(\n                              originalAppPath,\n                              workerResult.prerenderedRoutes\n                            )\n                            ssgPageRoutes = workerResult.prerenderedRoutes.map(\n                              (route) => route.pathname\n                            )\n                            isSSG = true\n                          }\n\n                          const appConfig = workerResult.appConfig || {}\n                          if (appConfig.revalidate !== 0) {\n                            const hasGenerateStaticParams =\n                              workerResult.prerenderedRoutes &&\n                              workerResult.prerenderedRoutes.length > 0\n\n                            if (\n                              config.output === 'export' &&\n                              isDynamic &&\n                              !hasGenerateStaticParams\n                            ) {\n                              throw new Error(\n                                `Page \"${page}\" is missing \"generateStaticParams()\" so it cannot be used with \"output: export\" config.`\n                              )\n                            }\n\n                            // Mark the app as static if:\n                            // - It has no dynamic param\n                            // - It doesn't have generateStaticParams but `dynamic` is set to\n                            //   `error` or `force-static`\n                            if (!isDynamic) {\n                              staticPaths.set(originalAppPath, [\n                                {\n                                  params: {},\n                                  pathname: page,\n                                  encodedPathname: page,\n                                  fallbackRouteParams: [],\n                                  fallbackMode:\n                                    workerResult.prerenderFallbackMode,\n                                  fallbackRootParams: [],\n                                  throwOnEmptyStaticShell: true,\n                                },\n                              ])\n                              isStatic = true\n                            } else if (\n                              !hasGenerateStaticParams &&\n                              (appConfig.dynamic === 'error' ||\n                                appConfig.dynamic === 'force-static')\n                            ) {\n                              staticPaths.set(originalAppPath, [])\n                              isStatic = true\n                              isRoutePPREnabled = false\n                            }\n                          }\n\n                          if (workerResult.prerenderFallbackMode) {\n                            fallbackModes.set(\n                              originalAppPath,\n                              workerResult.prerenderFallbackMode\n                            )\n                          }\n\n                          appDefaultConfigs.set(originalAppPath, appConfig)\n                        }\n                      } else {\n                        if (isEdgeRuntime(pageRuntime)) {\n                          if (workerResult.hasStaticProps) {\n                            console.warn(\n                              `\"getStaticProps\" is not yet supported fully with \"experimental-edge\", detected on ${page}`\n                            )\n                          }\n                          workerResult.isStatic = false\n                          workerResult.hasStaticProps = false\n                        }\n\n                        if (\n                          workerResult.isStatic === false &&\n                          (workerResult.isHybridAmp || workerResult.isAmpOnly)\n                        ) {\n                          hasSsrAmpPages = true\n                        }\n\n                        if (workerResult.isHybridAmp) {\n                          isHybridAmp = true\n                          hybridAmpPages.add(page)\n                        }\n\n                        if (workerResult.isNextImageImported) {\n                          isNextImageImported = true\n                        }\n\n                        if (workerResult.hasStaticProps) {\n                          ssgPages.add(page)\n                          isSSG = true\n\n                          if (\n                            workerResult.prerenderedRoutes &&\n                            workerResult.prerenderedRoutes.length > 0\n                          ) {\n                            additionalPaths.set(\n                              page,\n                              workerResult.prerenderedRoutes\n                            )\n                            ssgPageRoutes = workerResult.prerenderedRoutes.map(\n                              (route) => route.pathname\n                            )\n                          }\n\n                          if (\n                            workerResult.prerenderFallbackMode ===\n                            FallbackMode.BLOCKING_STATIC_RENDER\n                          ) {\n                            ssgBlockingFallbackPages.add(page)\n                          } else if (\n                            workerResult.prerenderFallbackMode ===\n                            FallbackMode.PRERENDER\n                          ) {\n                            ssgStaticFallbackPages.add(page)\n                          }\n                        } else if (workerResult.hasServerProps) {\n                          serverPropsPages.add(page)\n                        } else if (\n                          workerResult.isStatic &&\n                          !isServerComponent &&\n                          (await customAppGetInitialPropsPromise) === false\n                        ) {\n                          staticPages.add(page)\n                          isStatic = true\n                        } else if (isServerComponent) {\n                          // This is a static server component page that doesn't have\n                          // gSP or gSSP. We still treat it as a SSG page.\n                          ssgPages.add(page)\n                          isSSG = true\n                        }\n\n                        if (hasPages404 && page === '/404') {\n                          if (\n                            !workerResult.isStatic &&\n                            !workerResult.hasStaticProps\n                          ) {\n                            throw new Error(\n                              `\\`pages/404\\` ${STATIC_STATUS_PAGE_GET_INITIAL_PROPS_ERROR}`\n                            )\n                          }\n                          // we need to ensure the 404 lambda is present since we use\n                          // it when _app has getInitialProps\n                          if (\n                            (await customAppGetInitialPropsPromise) &&\n                            !workerResult.hasStaticProps\n                          ) {\n                            staticPages.delete(page)\n                          }\n                        }\n\n                        if (\n                          STATIC_STATUS_PAGES.includes(page) &&\n                          !workerResult.isStatic &&\n                          !workerResult.hasStaticProps\n                        ) {\n                          throw new Error(\n                            `\\`pages${page}\\` ${STATIC_STATUS_PAGE_GET_INITIAL_PROPS_ERROR}`\n                          )\n                        }\n                      }\n                    } catch (err) {\n                      if (\n                        !isError(err) ||\n                        err.message !== 'INVALID_DEFAULT_EXPORT'\n                      )\n                        throw err\n                      invalidPages.add(page)\n                    }\n                  }\n\n                  if (pageType === 'app') {\n                    if (isSSG || isStatic) {\n                      staticAppPagesCount++\n                    } else {\n                      serverAppPagesCount++\n                    }\n                  }\n                }\n\n                pageInfos.set(page, {\n                  originalAppPath,\n                  size,\n                  totalSize,\n                  isStatic,\n                  isSSG,\n                  isRoutePPREnabled,\n                  isHybridAmp,\n                  ssgPageRoutes,\n                  initialCacheControl: undefined,\n                  runtime: pageRuntime,\n                  pageDuration: undefined,\n                  ssgPageDurations: undefined,\n                  hasEmptyStaticShell: undefined,\n                })\n              })\n            })\n        )\n\n        if (hadUnsupportedValue) {\n          Log.error(\n            `Invalid config value exports detected, these can cause unexpected behavior from the configs not being applied. Please fix them to continue`\n          )\n          process.exit(1)\n        }\n\n        const errorPageResult = await errorPageStaticResult\n        const nonStaticErrorPage =\n          (await errorPageHasCustomGetInitialProps) ||\n          (errorPageResult && errorPageResult.hasServerProps)\n\n        const returnValue = {\n          customAppGetInitialProps: await customAppGetInitialPropsPromise,\n          namedExports: await namedExportsPromise,\n          isNextImageImported,\n          hasSsrAmpPages,\n          hasNonStaticErrorPage: nonStaticErrorPage,\n        }\n\n        return returnValue\n      })\n\n      if (postCompileSpinner) postCompileSpinner.stopAndPersist()\n      traceMemoryUsage('Finished collecting page data', nextBuildSpan)\n\n      if (customAppGetInitialProps) {\n        console.warn(\n          bold(yellow(`Warning: `)) +\n            yellow(\n              `You have opted-out of Automatic Static Optimization due to \\`getInitialProps\\` in \\`pages/_app\\`. This does not opt-out pages with \\`getStaticProps\\``\n            )\n        )\n        console.warn(\n          'Read more: https://nextjs.org/docs/messages/opt-out-auto-static-optimization\\n'\n        )\n      }\n\n      const { cacheHandler } = config\n\n      const instrumentationHookEntryFiles: string[] = []\n      if (hasInstrumentationHook) {\n        instrumentationHookEntryFiles.push(\n          path.join(SERVER_DIRECTORY, `${INSTRUMENTATION_HOOK_FILENAME}.js`)\n        )\n        // If there's edge routes, append the edge instrumentation hook\n        // Turbopack generates this chunk with a hashed name and references it in middleware-manifest.\n        if (!isTurbopack && (edgeRuntimeAppCount || edgeRuntimePagesCount)) {\n          instrumentationHookEntryFiles.push(\n            path.join(\n              SERVER_DIRECTORY,\n              `edge-${INSTRUMENTATION_HOOK_FILENAME}.js`\n            )\n          )\n        }\n      }\n\n      const requiredServerFilesManifest = nextBuildSpan\n        .traceChild('generate-required-server-files')\n        .traceFn(() => {\n          const normalizedCacheHandlers: Record<string, string> = {}\n\n          for (const [key, value] of Object.entries(\n            config.experimental.cacheHandlers || {}\n          )) {\n            if (key && value) {\n              normalizedCacheHandlers[key] = path.relative(distDir, value)\n            }\n          }\n\n          const serverFilesManifest: RequiredServerFilesManifest = {\n            version: 1,\n            config: {\n              ...config,\n              configFile: undefined,\n              ...(ciEnvironment.hasNextSupport\n                ? {\n                    compress: false,\n                  }\n                : {}),\n              cacheHandler: cacheHandler\n                ? path.relative(distDir, cacheHandler)\n                : config.cacheHandler,\n              experimental: {\n                ...config.experimental,\n                cacheHandlers: normalizedCacheHandlers,\n                trustHostHeader: ciEnvironment.hasNextSupport,\n                isExperimentalCompile: isCompileMode,\n              },\n            },\n            appDir: dir,\n            relativeAppDir: path.relative(outputFileTracingRoot, dir),\n            files: [\n              ROUTES_MANIFEST,\n              path.relative(distDir, pagesManifestPath),\n              BUILD_MANIFEST,\n              PRERENDER_MANIFEST,\n              path.join(SERVER_DIRECTORY, FUNCTIONS_CONFIG_MANIFEST),\n              path.join(SERVER_DIRECTORY, MIDDLEWARE_MANIFEST),\n              path.join(SERVER_DIRECTORY, MIDDLEWARE_BUILD_MANIFEST + '.js'),\n              ...(!isTurbopack\n                ? [\n                    path.join(\n                      SERVER_DIRECTORY,\n                      MIDDLEWARE_REACT_LOADABLE_MANIFEST + '.js'\n                    ),\n                    REACT_LOADABLE_MANIFEST,\n                  ]\n                : []),\n              ...(appDir\n                ? [\n                    ...(config.experimental.sri\n                      ? [\n                          path.join(\n                            SERVER_DIRECTORY,\n                            SUBRESOURCE_INTEGRITY_MANIFEST + '.js'\n                          ),\n                          path.join(\n                            SERVER_DIRECTORY,\n                            SUBRESOURCE_INTEGRITY_MANIFEST + '.json'\n                          ),\n                        ]\n                      : []),\n                    path.join(SERVER_DIRECTORY, APP_PATHS_MANIFEST),\n                    path.join(APP_PATH_ROUTES_MANIFEST),\n                    APP_BUILD_MANIFEST,\n                    path.join(\n                      SERVER_DIRECTORY,\n                      SERVER_REFERENCE_MANIFEST + '.js'\n                    ),\n                    path.join(\n                      SERVER_DIRECTORY,\n                      SERVER_REFERENCE_MANIFEST + '.json'\n                    ),\n                  ]\n                : []),\n              ...(pagesDir && !isTurbopack\n                ? [\n                    DYNAMIC_CSS_MANIFEST + '.json',\n                    path.join(SERVER_DIRECTORY, DYNAMIC_CSS_MANIFEST + '.js'),\n                  ]\n                : []),\n              BUILD_ID_FILE,\n              path.join(SERVER_DIRECTORY, NEXT_FONT_MANIFEST + '.js'),\n              path.join(SERVER_DIRECTORY, NEXT_FONT_MANIFEST + '.json'),\n              SERVER_FILES_MANIFEST,\n              ...instrumentationHookEntryFiles,\n            ]\n              .filter(nonNullable)\n              .map((file) => path.join(config.distDir, file)),\n            ignore: [] as string[],\n          }\n\n          return serverFilesManifest\n        })\n\n      if (!hasSsrAmpPages) {\n        requiredServerFilesManifest.ignore.push(\n          path.relative(\n            dir,\n            path.join(\n              path.dirname(\n                require.resolve(\n                  'next/dist/compiled/@ampproject/toolbox-optimizer'\n                )\n              ),\n              '**/*'\n            )\n          )\n        )\n      }\n\n      const middlewareFile = rootPaths.find((p) =>\n        p.includes(MIDDLEWARE_FILENAME)\n      )\n      let hasNodeMiddleware = false\n\n      if (middlewareFile) {\n        const staticInfo = await getStaticInfoIncludingLayouts({\n          isInsideAppDir: false,\n          pageFilePath: path.join(dir, middlewareFile),\n          config,\n          appDir,\n          pageExtensions: config.pageExtensions,\n          isDev: false,\n          page: 'middleware',\n        })\n\n        if (staticInfo.runtime === 'nodejs') {\n          hasNodeMiddleware = true\n          functionsConfigManifest.functions['/_middleware'] = {\n            runtime: staticInfo.runtime,\n            matchers: staticInfo.middleware?.matchers ?? [\n              {\n                regexp: '^.*$',\n                originalSource: '/:path*',\n              },\n            ],\n          }\n\n          if (isTurbopack) {\n            await writeManifest(\n              path.join(\n                distDir,\n                'static',\n                buildId,\n                TURBOPACK_CLIENT_MIDDLEWARE_MANIFEST\n              ),\n              functionsConfigManifest.functions['/_middleware'].matchers || []\n            )\n          }\n        }\n      }\n\n      await writeFunctionsConfigManifest(distDir, functionsConfigManifest)\n\n      if (!isGenerateMode && !buildTracesPromise) {\n        buildTracesPromise = collectBuildTraces({\n          dir,\n          config,\n          distDir,\n          edgeRuntimeRoutes: collectRoutesUsingEdgeRuntime(pageInfos),\n          staticPages: [...staticPages],\n          nextBuildSpan,\n          hasSsrAmpPages,\n          buildTraceContext,\n          outputFileTracingRoot,\n          isTurbopack: true,\n        }).catch((err) => {\n          console.error(err)\n          process.exit(1)\n        })\n      }\n\n      if (serverPropsPages.size > 0 || ssgPages.size > 0) {\n        // We update the routes manifest after the build with the\n        // data routes since we can't determine these until after build\n        routesManifest.dataRoutes = getSortedRoutes([\n          ...serverPropsPages,\n          ...ssgPages,\n        ]).map((page) => {\n          return buildDataRoute(page, buildId)\n        })\n      }\n\n      // We need to write the manifest with rewrites before build\n      await nextBuildSpan\n        .traceChild('write-routes-manifest')\n        .traceAsyncFn(() => writeManifest(routesManifestPath, routesManifest))\n\n      // Since custom _app.js can wrap the 404 page we have to opt-out of static optimization if it has getInitialProps\n      // Only export the static 404 when there is no /_error present\n      const useStaticPages404 =\n        !customAppGetInitialProps && (!hasNonStaticErrorPage || hasPages404)\n\n      if (invalidPages.size > 0) {\n        const err = new Error(\n          `Build optimization failed: found page${\n            invalidPages.size === 1 ? '' : 's'\n          } without a React Component as default export in \\n${[...invalidPages]\n            .map((pg) => `pages${pg}`)\n            .join(\n              '\\n'\n            )}\\n\\nSee https://nextjs.org/docs/messages/page-without-valid-component for more info.\\n`\n        ) as NextError\n        err.code = 'BUILD_OPTIMIZATION_FAILED'\n        throw err\n      }\n\n      await writeBuildId(distDir, buildId)\n\n      if (config.experimental.optimizeCss) {\n        const globOrig =\n          require('next/dist/compiled/glob') as typeof import('next/dist/compiled/glob')\n\n        const cssFilePaths = await new Promise<string[]>((resolve, reject) => {\n          globOrig(\n            '**/*.css',\n            { cwd: path.join(distDir, 'static') },\n            (err, files) => {\n              if (err) {\n                return reject(err)\n              }\n              resolve(files)\n            }\n          )\n        })\n\n        requiredServerFilesManifest.files.push(\n          ...cssFilePaths.map((filePath) =>\n            path.join(config.distDir, 'static', filePath)\n          )\n        )\n      }\n\n      const features: EventBuildFeatureUsage[] = [\n        {\n          featureName: 'experimental/dynamicIO',\n          invocationCount: config.experimental.dynamicIO ? 1 : 0,\n        },\n        {\n          featureName: 'experimental/optimizeCss',\n          invocationCount: config.experimental.optimizeCss ? 1 : 0,\n        },\n        {\n          featureName: 'experimental/nextScriptWorkers',\n          invocationCount: config.experimental.nextScriptWorkers ? 1 : 0,\n        },\n        {\n          featureName: 'experimental/ppr',\n          invocationCount: config.experimental.ppr ? 1 : 0,\n        },\n        {\n          featureName: 'turbopackPersistentCaching',\n          invocationCount: isPersistentCachingEnabled(config) ? 1 : 0,\n        },\n      ]\n      telemetry.record(\n        features.map((feature) => {\n          return {\n            eventName: EVENT_BUILD_FEATURE_USAGE,\n            payload: feature,\n          }\n        })\n      )\n\n      await writeRequiredServerFilesManifest(\n        distDir,\n        requiredServerFilesManifest\n      )\n\n      // we don't need to inline for turbopack build as\n      // it will handle it's own caching separate of compile\n      if (isGenerateMode && !isTurbopack) {\n        Log.info('Inlining static env ...')\n\n        await nextBuildSpan\n          .traceChild('inline-static-env')\n          .traceAsyncFn(async () => {\n            await inlineStaticEnv({\n              distDir,\n              config,\n            })\n          })\n      }\n\n      const middlewareManifest: MiddlewareManifest = await readManifest(\n        path.join(distDir, SERVER_DIRECTORY, MIDDLEWARE_MANIFEST)\n      )\n\n      const prerenderManifest: PrerenderManifest = {\n        version: 4,\n        routes: {},\n        dynamicRoutes: {},\n        notFoundRoutes: [],\n        preview: previewProps,\n      }\n\n      const tbdPrerenderRoutes: string[] = []\n\n      const { i18n } = config\n\n      const usedStaticStatusPages = STATIC_STATUS_PAGES.filter(\n        (page) =>\n          mappedPages[page] &&\n          mappedPages[page].startsWith('private-next-pages')\n      )\n      usedStaticStatusPages.forEach((page) => {\n        if (!ssgPages.has(page) && !customAppGetInitialProps) {\n          staticPages.add(page)\n        }\n      })\n\n      const hasPages500 = usedStaticStatusPages.includes('/500')\n      const useDefaultStatic500 =\n        !hasPages500 && !hasNonStaticErrorPage && !customAppGetInitialProps\n\n      const combinedPages = [...staticPages, ...ssgPages]\n      const isApp404Static = staticPaths.has(UNDERSCORE_NOT_FOUND_ROUTE_ENTRY)\n      const hasStaticApp404 = hasApp404 && isApp404Static\n\n      await updateBuildDiagnostics({\n        buildStage: 'static-generation',\n      })\n\n      // we need to trigger automatic exporting when we have\n      // - static 404/500\n      // - getStaticProps paths\n      // - experimental app is enabled\n      if (\n        !isCompileMode &&\n        (combinedPages.length > 0 ||\n          useStaticPages404 ||\n          useDefaultStatic500 ||\n          appDir)\n      ) {\n        const staticGenerationSpan =\n          nextBuildSpan.traceChild('static-generation')\n        await staticGenerationSpan.traceAsyncFn(async () => {\n          detectConflictingPaths(\n            [\n              ...combinedPages,\n              ...pageKeys.pages.filter((page) => !combinedPages.includes(page)),\n            ],\n            ssgPages,\n            new Map(\n              Array.from(additionalPaths.entries()).map(\n                ([page, routes]): [string, string[]] => {\n                  return [page, routes.map((route) => route.pathname)]\n                }\n              )\n            )\n          )\n\n          const exportApp = require('../export')\n            .default as typeof import('../export').default\n\n          const exportConfig: NextConfigComplete = {\n            ...config,\n            // Default map will be the collection of automatic statically exported\n            // pages and incremental pages.\n            // n.b. we cannot handle this above in combinedPages because the dynamic\n            // page must be in the `pages` array, but not in the mapping.\n            exportPathMap: (defaultMap: ExportPathMap) => {\n              // Dynamically routed pages should be prerendered to be used as\n              // a client-side skeleton (fallback) while data is being fetched.\n              // This ensures the end-user never sees a 500 or slow response from the\n              // server.\n              //\n              // Note: prerendering disables automatic static optimization.\n              ssgPages.forEach((page) => {\n                if (isDynamicRoute(page)) {\n                  tbdPrerenderRoutes.push(page)\n\n                  if (ssgStaticFallbackPages.has(page)) {\n                    // Override the rendering for the dynamic page to be treated as a\n                    // fallback render.\n                    if (i18n) {\n                      defaultMap[`/${i18n.defaultLocale}${page}`] = {\n                        page,\n                        _pagesFallback: true,\n                      }\n                    } else {\n                      defaultMap[page] = {\n                        page,\n                        _pagesFallback: true,\n                      }\n                    }\n                  } else {\n                    // Remove dynamically routed pages from the default path map when\n                    // fallback behavior is disabled.\n                    delete defaultMap[page]\n                  }\n                }\n              })\n\n              // Append the \"well-known\" routes we should prerender for, e.g. blog\n              // post slugs.\n              additionalPaths.forEach((routes, page) => {\n                routes.forEach((route) => {\n                  defaultMap[route.pathname] = {\n                    page,\n                    _ssgPath: route.encodedPathname,\n                  }\n                })\n              })\n\n              if (useStaticPages404) {\n                defaultMap['/404'] = {\n                  page: hasPages404 ? '/404' : '/_error',\n                }\n              }\n\n              if (useDefaultStatic500) {\n                defaultMap['/500'] = {\n                  page: '/_error',\n                }\n              }\n\n              // TODO: output manifest specific to app paths and their\n              // revalidate periods and dynamicParams settings\n              staticPaths.forEach((routes, originalAppPath) => {\n                const appConfig = appDefaultConfigs.get(originalAppPath)\n                const isDynamicError = appConfig?.dynamic === 'error'\n\n                const isRoutePPREnabled: boolean = appConfig\n                  ? checkIsRoutePPREnabled(config.experimental.ppr, appConfig)\n                  : false\n\n                routes.forEach((route) => {\n                  // If the route has any dynamic root segments, we need to skip\n                  // rendering the route. This is because we don't support\n                  // revalidating the shells without the parameters present.\n                  if (\n                    route.fallbackRootParams &&\n                    route.fallbackRootParams.length > 0\n                  ) {\n                    return\n                  }\n\n                  defaultMap[route.pathname] = {\n                    page: originalAppPath,\n                    _ssgPath: route.encodedPathname,\n                    _fallbackRouteParams: route.fallbackRouteParams,\n                    _isDynamicError: isDynamicError,\n                    _isAppDir: true,\n                    _isRoutePPREnabled: isRoutePPREnabled,\n                    _allowEmptyStaticShell: !route.throwOnEmptyStaticShell,\n                  }\n                })\n              })\n\n              if (i18n) {\n                for (const page of [\n                  ...staticPages,\n                  ...ssgPages,\n                  ...(useStaticPages404 ? ['/404'] : []),\n                  ...(useDefaultStatic500 ? ['/500'] : []),\n                ]) {\n                  const isSsg = ssgPages.has(page)\n                  const isDynamic = isDynamicRoute(page)\n                  const isFallback = isSsg && ssgStaticFallbackPages.has(page)\n\n                  for (const locale of i18n.locales) {\n                    // skip fallback generation for SSG pages without fallback mode\n                    if (isSsg && isDynamic && !isFallback) continue\n                    const outputPath = `/${locale}${page === '/' ? '' : page}`\n\n                    defaultMap[outputPath] = {\n                      page: defaultMap[page]?.page || page,\n                      _locale: locale,\n                      _pagesFallback: isFallback,\n                    }\n                  }\n\n                  if (isSsg) {\n                    // remove non-locale prefixed variant from defaultMap\n                    delete defaultMap[page]\n                  }\n                }\n              }\n\n              return defaultMap\n            },\n          }\n\n          const outdir = path.join(distDir, 'export')\n          const exportResult = await exportApp(\n            dir,\n            {\n              nextConfig: exportConfig,\n              enabledDirectories,\n              silent: true,\n              buildExport: true,\n              debugOutput,\n              pages: combinedPages,\n              outdir,\n              statusMessage: 'Generating static pages',\n              numWorkers: getNumberOfWorkers(exportConfig),\n            },\n            nextBuildSpan\n          )\n\n          // If there was no result, there's nothing more to do.\n          if (!exportResult) return\n\n          const getFallbackMode = (route: PrerenderedRoute) => {\n            const hasEmptyStaticShell = exportResult.byPath.get(\n              route.pathname\n            )?.hasEmptyStaticShell\n\n            // If the route has an empty static shell and is not configured to\n            // throw on empty static shell, then we should use the blocking\n            // static render mode.\n            if (\n              hasEmptyStaticShell &&\n              !route.throwOnEmptyStaticShell &&\n              route.fallbackMode === FallbackMode.PRERENDER\n            ) {\n              return FallbackMode.BLOCKING_STATIC_RENDER\n            }\n\n            // If the route has no fallback mode, then we should use the\n            // `NOT_FOUND` fallback mode.\n            if (!route.fallbackMode) {\n              return FallbackMode.NOT_FOUND\n            }\n\n            return route.fallbackMode\n          }\n\n          const getCacheControl = (\n            exportPath: string,\n            defaultRevalidate: Revalidate = false\n          ): CacheControl => {\n            const cacheControl =\n              exportResult.byPath.get(exportPath)?.cacheControl\n\n            if (!cacheControl) {\n              return { revalidate: defaultRevalidate, expire: undefined }\n            }\n\n            if (\n              cacheControl.revalidate !== false &&\n              cacheControl.revalidate > 0 &&\n              cacheControl.expire === undefined\n            ) {\n              return {\n                revalidate: cacheControl.revalidate,\n                expire: config.expireTime,\n              }\n            }\n\n            return cacheControl\n          }\n\n          if (debugOutput || process.env.NEXT_SSG_FETCH_METRICS === '1') {\n            recordFetchMetrics(exportResult)\n          }\n\n          writeTurborepoAccessTraceResult({\n            distDir: config.distDir,\n            traces: [\n              turborepoAccessTraceResult,\n              ...exportResult.turborepoAccessTraceResults.values(),\n            ],\n          })\n\n          prerenderManifest.notFoundRoutes = Array.from(\n            exportResult.ssgNotFoundPaths\n          )\n\n          // remove server bundles that were exported\n          for (const page of staticPages) {\n            const serverBundle = getPagePath(page, distDir, undefined, false)\n            await fs.unlink(serverBundle)\n          }\n\n          staticPaths.forEach((prerenderedRoutes, originalAppPath) => {\n            const page = appNormalizedPaths.get(originalAppPath)\n            if (!page) throw new InvariantError('Page not found')\n\n            const appConfig = appDefaultConfigs.get(originalAppPath)\n            if (!appConfig) throw new InvariantError('App config not found')\n\n            let hasRevalidateZero =\n              appConfig.revalidate === 0 ||\n              getCacheControl(page).revalidate === 0\n\n            if (hasRevalidateZero && pageInfos.get(page)?.isStatic) {\n              // if the page was marked as being static, but it contains dynamic data\n              // (ie, in the case of a static generation bailout), then it should be marked dynamic\n              pageInfos.set(page, {\n                ...(pageInfos.get(page) as PageInfo),\n                isStatic: false,\n                isSSG: false,\n              })\n            }\n\n            const isAppRouteHandler = isAppRouteRoute(originalAppPath)\n\n            // When this is an app page and PPR is enabled, the route supports\n            // partial pre-rendering.\n            const isRoutePPREnabled: true | undefined =\n              !isAppRouteHandler &&\n              checkIsRoutePPREnabled(config.experimental.ppr, appConfig)\n                ? true\n                : undefined\n\n            const htmlBotsRegexString =\n              // The htmlLimitedBots has been converted to a string during loadConfig\n              config.htmlLimitedBots || HTML_LIMITED_BOT_UA_RE_STRING\n\n            // this flag is used to selectively bypass the static cache and invoke the lambda directly\n            // to enable server actions on static routes\n            const bypassFor: RouteHas[] = [\n              { type: 'header', key: ACTION_HEADER },\n              {\n                type: 'header',\n                key: 'content-type',\n                value: 'multipart/form-data;.*',\n              },\n              // If it's PPR rendered non-static page, bypass the PPR cache when streaming metadata is enabled.\n              // This will skip the postpone data for those bots requests and instead produce a dynamic render.\n              ...(isRoutePPREnabled\n                ? [\n                    {\n                      type: 'header',\n                      key: 'user-agent',\n                      value: htmlBotsRegexString,\n                    },\n                  ]\n                : []),\n            ]\n\n            // We should collect all the dynamic routes into a single array for\n            // this page. Including the full fallback route (the original\n            // route), any routes that were generated with unknown route params\n            // should be collected and included in the dynamic routes part\n            // of the manifest instead.\n            const routes: PrerenderedRoute[] = []\n            const dynamicRoutes: PrerenderedRoute[] = []\n\n            // Sort the outputted routes to ensure consistent output. Any route\n            // though that has unknown route params will be pulled and sorted\n            // independently. This is because the routes with unknown route\n            // params will contain the dynamic path parameters, some of which\n            // may conflict with the actual prerendered routes.\n            let unknownPrerenderRoutes: PrerenderedRoute[] = []\n            let knownPrerenderRoutes: PrerenderedRoute[] = []\n            for (const prerenderedRoute of prerenderedRoutes) {\n              if (\n                prerenderedRoute.fallbackRouteParams &&\n                prerenderedRoute.fallbackRouteParams.length > 0\n              ) {\n                unknownPrerenderRoutes.push(prerenderedRoute)\n              } else {\n                knownPrerenderRoutes.push(prerenderedRoute)\n              }\n            }\n\n            unknownPrerenderRoutes = getSortedRouteObjects(\n              unknownPrerenderRoutes,\n              (prerenderedRoute) => prerenderedRoute.pathname\n            )\n            knownPrerenderRoutes = getSortedRouteObjects(\n              knownPrerenderRoutes,\n              (prerenderedRoute) => prerenderedRoute.pathname\n            )\n\n            prerenderedRoutes = [\n              ...knownPrerenderRoutes,\n              ...unknownPrerenderRoutes,\n            ]\n\n            for (const prerenderedRoute of prerenderedRoutes) {\n              // TODO: check if still needed?\n              // Exclude the /_not-found route.\n              if (prerenderedRoute.pathname === UNDERSCORE_NOT_FOUND_ROUTE) {\n                continue\n              }\n\n              if (\n                isRoutePPREnabled &&\n                prerenderedRoute.fallbackRouteParams &&\n                prerenderedRoute.fallbackRouteParams.length > 0\n              ) {\n                // If the route has unknown params, then we need to add it to\n                // the list of dynamic routes.\n                dynamicRoutes.push(prerenderedRoute)\n              } else {\n                // If the route doesn't have unknown params, then we need to\n                // add it to the list of routes.\n                routes.push(prerenderedRoute)\n              }\n            }\n\n            // Handle all the static routes.\n            for (const route of routes) {\n              if (isDynamicRoute(page) && route.pathname === page) continue\n              if (route.pathname === UNDERSCORE_NOT_FOUND_ROUTE) continue\n\n              const {\n                metadata = {},\n                hasEmptyStaticShell,\n                hasPostponed,\n              } = exportResult.byPath.get(route.pathname) ?? {}\n\n              const cacheControl = getCacheControl(\n                route.pathname,\n                appConfig.revalidate\n              )\n\n              pageInfos.set(route.pathname, {\n                ...(pageInfos.get(route.pathname) as PageInfo),\n                hasPostponed,\n                hasEmptyStaticShell,\n                initialCacheControl: cacheControl,\n              })\n\n              // update the page (eg /blog/[slug]) to also have the postpone metadata\n              pageInfos.set(page, {\n                ...(pageInfos.get(page) as PageInfo),\n                hasPostponed,\n                hasEmptyStaticShell,\n                initialCacheControl: cacheControl,\n              })\n\n              if (cacheControl.revalidate !== 0) {\n                const normalizedRoute = normalizePagePath(route.pathname)\n\n                let dataRoute: string | null\n                if (isAppRouteHandler) {\n                  dataRoute = null\n                } else {\n                  dataRoute = path.posix.join(`${normalizedRoute}${RSC_SUFFIX}`)\n                }\n\n                let prefetchDataRoute: string | null | undefined\n                // While we may only write the `.rsc` when the route does not\n                // have PPR enabled, we still want to generate the route when\n                // deployed so it doesn't 404. If the app has PPR enabled, we\n                // should add this key.\n                if (!isAppRouteHandler && isAppPPREnabled) {\n                  prefetchDataRoute = path.posix.join(\n                    `${normalizedRoute}${RSC_PREFETCH_SUFFIX}`\n                  )\n                }\n\n                const meta = collectMeta(metadata)\n\n                prerenderManifest.routes[route.pathname] = {\n                  initialStatus: meta.status,\n                  initialHeaders: meta.headers,\n                  renderingMode: isAppPPREnabled\n                    ? isRoutePPREnabled\n                      ? RenderingMode.PARTIALLY_STATIC\n                      : RenderingMode.STATIC\n                    : undefined,\n                  experimentalPPR: isRoutePPREnabled,\n                  experimentalBypassFor: bypassFor,\n                  initialRevalidateSeconds: cacheControl.revalidate,\n                  initialExpireSeconds: cacheControl.expire,\n                  srcRoute: page,\n                  dataRoute,\n                  prefetchDataRoute,\n                  allowHeader: ALLOWED_HEADERS,\n                }\n              } else {\n                hasRevalidateZero = true\n                // we might have determined during prerendering that this page\n                // used dynamic data\n                pageInfos.set(route.pathname, {\n                  ...(pageInfos.get(route.pathname) as PageInfo),\n                  isSSG: false,\n                  isStatic: false,\n                })\n              }\n            }\n\n            if (!hasRevalidateZero && isDynamicRoute(page)) {\n              // When PPR fallbacks aren't used, we need to include it here. If\n              // they are enabled, then it'll already be included in the\n              // prerendered routes.\n              if (!isRoutePPREnabled) {\n                dynamicRoutes.push({\n                  params: {},\n                  pathname: page,\n                  encodedPathname: page,\n                  fallbackRouteParams: [],\n                  fallbackMode:\n                    fallbackModes.get(originalAppPath) ??\n                    FallbackMode.NOT_FOUND,\n                  fallbackRootParams: [],\n                  throwOnEmptyStaticShell: true,\n                })\n              }\n\n              for (const route of dynamicRoutes) {\n                const normalizedRoute = normalizePagePath(route.pathname)\n\n                const metadata = exportResult.byPath.get(\n                  route.pathname\n                )?.metadata\n\n                const cacheControl = getCacheControl(route.pathname)\n\n                let dataRoute: string | null = null\n                if (!isAppRouteHandler) {\n                  dataRoute = path.posix.join(`${normalizedRoute}${RSC_SUFFIX}`)\n                }\n\n                let prefetchDataRoute: string | undefined\n                if (!isAppRouteHandler && isAppPPREnabled) {\n                  prefetchDataRoute = path.posix.join(\n                    `${normalizedRoute}${RSC_PREFETCH_SUFFIX}`\n                  )\n                }\n\n                if (!isAppRouteHandler && metadata?.segmentPaths) {\n                  const dynamicRoute = routesManifest.dynamicRoutes.find(\n                    (r) => r.page === page\n                  )\n                  if (!dynamicRoute) {\n                    throw new Error('Dynamic route not found')\n                  }\n\n                  dynamicRoute.prefetchSegmentDataRoutes ??= []\n                  for (const segmentPath of metadata.segmentPaths) {\n                    dynamicRoute.prefetchSegmentDataRoutes.push(\n                      buildPrefetchSegmentDataRoute(route.pathname, segmentPath)\n                    )\n                  }\n                }\n\n                pageInfos.set(route.pathname, {\n                  ...(pageInfos.get(route.pathname) as PageInfo),\n                  isDynamicAppRoute: true,\n                  // if PPR is turned on and the route contains a dynamic segment,\n                  // we assume it'll be partially prerendered\n                  hasPostponed: isRoutePPREnabled,\n                })\n\n                const fallbackMode = getFallbackMode(route)\n\n                // When the route is configured to serve a prerender, we should\n                // use the cache control from the export result. If it can't be\n                // found, mark that we should keep the shell forever\n                // (revalidate: `false` via `getCacheControl()`).\n                const fallbackCacheControl =\n                  isRoutePPREnabled && fallbackMode === FallbackMode.PRERENDER\n                    ? cacheControl\n                    : undefined\n\n                const fallback: Fallback = fallbackModeToFallbackField(\n                  fallbackMode,\n                  route.pathname\n                )\n\n                const meta =\n                  metadata &&\n                  isRoutePPREnabled &&\n                  fallbackMode === FallbackMode.PRERENDER\n                    ? collectMeta(metadata)\n                    : {}\n\n                prerenderManifest.dynamicRoutes[route.pathname] = {\n                  experimentalPPR: isRoutePPREnabled,\n                  renderingMode: isAppPPREnabled\n                    ? isRoutePPREnabled\n                      ? RenderingMode.PARTIALLY_STATIC\n                      : RenderingMode.STATIC\n                    : undefined,\n                  experimentalBypassFor: bypassFor,\n                  routeRegex: normalizeRouteRegex(\n                    getNamedRouteRegex(route.pathname, {\n                      prefixRouteKeys: false,\n                    }).re.source\n                  ),\n                  dataRoute,\n                  fallback,\n                  fallbackRevalidate: fallbackCacheControl?.revalidate,\n                  fallbackExpire: fallbackCacheControl?.expire,\n                  fallbackStatus: meta.status,\n                  fallbackHeaders: meta.headers,\n                  fallbackRootParams: fallback\n                    ? route.fallbackRootParams\n                    : undefined,\n                  fallbackSourceRoute: route.fallbackRouteParams?.length\n                    ? page\n                    : undefined,\n                  dataRouteRegex: !dataRoute\n                    ? null\n                    : normalizeRouteRegex(\n                        getNamedRouteRegex(dataRoute, {\n                          prefixRouteKeys: false,\n                          includeSuffix: true,\n                          excludeOptionalTrailingSlash: true,\n                        }).re.source\n                      ),\n                  prefetchDataRoute,\n                  prefetchDataRouteRegex: !prefetchDataRoute\n                    ? undefined\n                    : normalizeRouteRegex(\n                        getNamedRouteRegex(prefetchDataRoute, {\n                          prefixRouteKeys: false,\n                          includeSuffix: true,\n                          excludeOptionalTrailingSlash: true,\n                        }).re.source\n                      ),\n                  allowHeader: ALLOWED_HEADERS,\n                }\n              }\n            }\n          })\n\n          const moveExportedPage = async (\n            originPage: string,\n            page: string,\n            file: string,\n            isSsg: boolean,\n            ext: 'html' | 'json',\n            additionalSsgFile = false\n          ) => {\n            return staticGenerationSpan\n              .traceChild('move-exported-page')\n              .traceAsyncFn(async () => {\n                file = `${file}.${ext}`\n                const orig = path.join(outdir, file)\n                const pagePath = getPagePath(\n                  originPage,\n                  distDir,\n                  undefined,\n                  false\n                )\n\n                const relativeDest = path\n                  .relative(\n                    path.join(distDir, SERVER_DIRECTORY),\n                    path.join(\n                      path.join(\n                        pagePath,\n                        // strip leading / and then recurse number of nested dirs\n                        // to place from base folder\n                        originPage\n                          .slice(1)\n                          .split('/')\n                          .map(() => '..')\n                          .join('/')\n                      ),\n                      file\n                    )\n                  )\n                  .replace(/\\\\/g, '/')\n\n                if (\n                  !isSsg &&\n                  !(\n                    // don't add static status page to manifest if it's\n                    // the default generated version e.g. no pages/500\n                    (\n                      STATIC_STATUS_PAGES.includes(page) &&\n                      !usedStaticStatusPages.includes(page)\n                    )\n                  )\n                ) {\n                  pagesManifest[page] = relativeDest\n                }\n\n                const dest = path.join(distDir, SERVER_DIRECTORY, relativeDest)\n                const isNotFound =\n                  prerenderManifest.notFoundRoutes.includes(page)\n\n                // for SSG files with i18n the non-prerendered variants are\n                // output with the locale prefixed so don't attempt moving\n                // without the prefix\n                if ((!i18n || additionalSsgFile) && !isNotFound) {\n                  await fs.mkdir(path.dirname(dest), { recursive: true })\n                  await fs.rename(orig, dest)\n                } else if (i18n && !isSsg) {\n                  // this will be updated with the locale prefixed variant\n                  // since all files are output with the locale prefix\n                  delete pagesManifest[page]\n                }\n\n                if (i18n) {\n                  if (additionalSsgFile) return\n\n                  const localeExt = page === '/' ? path.extname(file) : ''\n                  const relativeDestNoPages = relativeDest.slice(\n                    'pages/'.length\n                  )\n\n                  for (const locale of i18n.locales) {\n                    const curPath = `/${locale}${page === '/' ? '' : page}`\n\n                    if (\n                      isSsg &&\n                      prerenderManifest.notFoundRoutes.includes(curPath)\n                    ) {\n                      continue\n                    }\n\n                    const updatedRelativeDest = path\n                      .join(\n                        'pages',\n                        locale + localeExt,\n                        // if it's the top-most index page we want it to be locale.EXT\n                        // instead of locale/index.html\n                        page === '/' ? '' : relativeDestNoPages\n                      )\n                      .replace(/\\\\/g, '/')\n\n                    const updatedOrig = path.join(\n                      outdir,\n                      locale + localeExt,\n                      page === '/' ? '' : file\n                    )\n                    const updatedDest = path.join(\n                      distDir,\n                      SERVER_DIRECTORY,\n                      updatedRelativeDest\n                    )\n\n                    if (!isSsg) {\n                      pagesManifest[curPath] = updatedRelativeDest\n                    }\n                    await fs.mkdir(path.dirname(updatedDest), {\n                      recursive: true,\n                    })\n                    await fs.rename(updatedOrig, updatedDest)\n                  }\n                }\n              })\n          }\n\n          async function moveExportedAppNotFoundTo404() {\n            return staticGenerationSpan\n              .traceChild('move-exported-app-not-found-')\n              .traceAsyncFn(async () => {\n                const orig = path.join(\n                  distDir,\n                  'server',\n                  'app',\n                  '_not-found.html'\n                )\n                const updatedRelativeDest = path\n                  .join('pages', '404.html')\n                  .replace(/\\\\/g, '/')\n\n                if (existsSync(orig)) {\n                  await fs.copyFile(\n                    orig,\n                    path.join(distDir, 'server', updatedRelativeDest)\n                  )\n\n                  // since the app router not found is prioritized over pages router,\n                  // we have to ensure the app router entries are available for all locales\n                  if (i18n) {\n                    for (const locale of i18n.locales) {\n                      const curPath = `/${locale}/404`\n                      pagesManifest[curPath] = updatedRelativeDest\n                    }\n                  }\n\n                  pagesManifest['/404'] = updatedRelativeDest\n                }\n              })\n          }\n\n          // If there's /not-found inside app, we prefer it over the pages 404\n          if (hasStaticApp404) {\n            await moveExportedAppNotFoundTo404()\n          } else {\n            // Only move /404 to /404 when there is no custom 404 as in that case we don't know about the 404 page\n            if (!hasPages404 && !hasApp404 && useStaticPages404) {\n              await moveExportedPage('/_error', '/404', '/404', false, 'html')\n            }\n          }\n\n          if (useDefaultStatic500) {\n            await moveExportedPage('/_error', '/500', '/500', false, 'html')\n          }\n\n          for (const page of combinedPages) {\n            const isSsg = ssgPages.has(page)\n            const isStaticSsgFallback = ssgStaticFallbackPages.has(page)\n            const isDynamic = isDynamicRoute(page)\n            const hasAmp = hybridAmpPages.has(page)\n            const file = normalizePagePath(page)\n\n            const pageInfo = pageInfos.get(page)\n            const durationInfo = exportResult.byPage.get(page)\n            if (pageInfo && durationInfo) {\n              // Set Build Duration\n              if (pageInfo.ssgPageRoutes) {\n                pageInfo.ssgPageDurations = pageInfo.ssgPageRoutes.map(\n                  (pagePath) => {\n                    const duration = durationInfo.durationsByPath.get(pagePath)\n                    if (typeof duration === 'undefined') {\n                      throw new Error(\"Invariant: page wasn't built\")\n                    }\n\n                    return duration\n                  }\n                )\n              }\n              pageInfo.pageDuration = durationInfo.durationsByPath.get(page)\n            }\n\n            // The dynamic version of SSG pages are only prerendered if the\n            // fallback is enabled. Below, we handle the specific prerenders\n            // of these.\n            const hasHtmlOutput = !(isSsg && isDynamic && !isStaticSsgFallback)\n\n            if (hasHtmlOutput) {\n              await moveExportedPage(page, page, file, isSsg, 'html')\n            }\n\n            if (hasAmp && (!isSsg || (isSsg && !isDynamic))) {\n              const ampPage = `${file}.amp`\n              await moveExportedPage(page, ampPage, ampPage, isSsg, 'html')\n\n              if (isSsg) {\n                await moveExportedPage(page, ampPage, ampPage, isSsg, 'json')\n              }\n            }\n\n            if (isSsg) {\n              // For a non-dynamic SSG page, we must copy its data file\n              // from export, we already moved the HTML file above\n              if (!isDynamic) {\n                await moveExportedPage(page, page, file, isSsg, 'json')\n\n                if (i18n) {\n                  // TODO: do we want to show all locale variants in build output\n                  for (const locale of i18n.locales) {\n                    const localePage = `/${locale}${page === '/' ? '' : page}`\n\n                    const cacheControl = getCacheControl(localePage)\n\n                    prerenderManifest.routes[localePage] = {\n                      initialRevalidateSeconds: cacheControl.revalidate,\n                      initialExpireSeconds: cacheControl.expire,\n                      experimentalPPR: undefined,\n                      renderingMode: undefined,\n                      srcRoute: null,\n                      dataRoute: path.posix.join(\n                        '/_next/data',\n                        buildId,\n                        `${file}.json`\n                      ),\n                      prefetchDataRoute: undefined,\n                      allowHeader: ALLOWED_HEADERS,\n                    }\n                  }\n                } else {\n                  const cacheControl = getCacheControl(page)\n\n                  prerenderManifest.routes[page] = {\n                    initialRevalidateSeconds: cacheControl.revalidate,\n                    initialExpireSeconds: cacheControl.expire,\n                    experimentalPPR: undefined,\n                    renderingMode: undefined,\n                    srcRoute: null,\n                    dataRoute: path.posix.join(\n                      '/_next/data',\n                      buildId,\n                      `${file}.json`\n                    ),\n                    // Pages does not have a prefetch data route.\n                    prefetchDataRoute: undefined,\n                    allowHeader: ALLOWED_HEADERS,\n                  }\n                }\n                if (pageInfo) {\n                  pageInfo.initialCacheControl = getCacheControl(page)\n                }\n              } else {\n                // For a dynamic SSG page, we did not copy its data exports and only\n                // copy the fallback HTML file (if present).\n                // We must also copy specific versions of this page as defined by\n                // `getStaticPaths` (additionalSsgPaths).\n                for (const route of additionalPaths.get(page) ?? []) {\n                  const pageFile = normalizePagePath(route.pathname)\n                  await moveExportedPage(\n                    page,\n                    route.pathname,\n                    pageFile,\n                    isSsg,\n                    'html',\n                    true\n                  )\n                  await moveExportedPage(\n                    page,\n                    route.pathname,\n                    pageFile,\n                    isSsg,\n                    'json',\n                    true\n                  )\n\n                  if (hasAmp) {\n                    const ampPage = `${pageFile}.amp`\n                    await moveExportedPage(\n                      page,\n                      ampPage,\n                      ampPage,\n                      isSsg,\n                      'html',\n                      true\n                    )\n                    await moveExportedPage(\n                      page,\n                      ampPage,\n                      ampPage,\n                      isSsg,\n                      'json',\n                      true\n                    )\n                  }\n\n                  const cacheControl = getCacheControl(route.pathname)\n\n                  prerenderManifest.routes[route.pathname] = {\n                    initialRevalidateSeconds: cacheControl.revalidate,\n                    initialExpireSeconds: cacheControl.expire,\n                    experimentalPPR: undefined,\n                    renderingMode: undefined,\n                    srcRoute: page,\n                    dataRoute: path.posix.join(\n                      '/_next/data',\n                      buildId,\n                      `${normalizePagePath(route.pathname)}.json`\n                    ),\n                    // Pages does not have a prefetch data route.\n                    prefetchDataRoute: undefined,\n                    allowHeader: ALLOWED_HEADERS,\n                  }\n\n                  if (pageInfo) {\n                    pageInfo.initialCacheControl = cacheControl\n                  }\n                }\n              }\n            }\n          }\n\n          // remove temporary export folder\n          await fs.rm(outdir, { recursive: true, force: true })\n          await writeManifest(pagesManifestPath, pagesManifest)\n\n          if (config.experimental.clientSegmentCache) {\n            for (const route of [\n              ...routesManifest.staticRoutes,\n              ...routesManifest.dynamicRoutes,\n            ]) {\n              // If the segment paths aren't defined, we need to insert a\n              // reverse routing rule so that there isn't any conflicts\n              // with other dynamic routes for the prefetch segment\n              // routes. This is true for any route that is not PPR-enabled,\n              // including all routes defined by Pages Router.\n\n              // We don't need to add the prefetch segment data routes if it was\n              // added due to a page that was already generated. This would have\n              // happened if the page was static or partially static.\n              if (route.prefetchSegmentDataRoutes) {\n                continue\n              }\n\n              route.prefetchSegmentDataRoutes = [\n                buildInversePrefetchSegmentDataRoute(\n                  route.page,\n                  // We use the special segment path of `/_tree` because it's\n                  // the first one sent by the client router so it's the only\n                  // one we need to rewrite to the regular prefetch RSC route.\n                  '/_tree'\n                ),\n              ]\n            }\n          }\n        })\n\n        // We need to write the manifest with rewrites after build as it might\n        // have been modified.\n        await nextBuildSpan\n          .traceChild('write-routes-manifest')\n          .traceAsyncFn(() => writeManifest(routesManifestPath, routesManifest))\n      }\n\n      const postBuildSpinner = createSpinner('Finalizing page optimization')\n      let buildTracesSpinner = createSpinner(`Collecting build traces`)\n\n      // ensure the worker is not left hanging\n      worker.end()\n\n      const analysisEnd = process.hrtime(analysisBegin)\n      telemetry.record(\n        eventBuildOptimize(pagesPaths, {\n          durationInSeconds: analysisEnd[0],\n          staticPageCount: staticPages.size,\n          staticPropsPageCount: ssgPages.size,\n          serverPropsPageCount: serverPropsPages.size,\n          ssrPageCount:\n            pagesPaths.length -\n            (staticPages.size + ssgPages.size + serverPropsPages.size),\n          hasStatic404: useStaticPages404,\n          hasReportWebVitals:\n            namedExports?.includes('reportWebVitals') ?? false,\n          rewritesCount: combinedRewrites.length,\n          headersCount: headers.length,\n          redirectsCount: redirects.length - 1, // reduce one for trailing slash\n          headersWithHasCount: headers.filter((r: any) => !!r.has).length,\n          rewritesWithHasCount: combinedRewrites.filter((r: any) => !!r.has)\n            .length,\n          redirectsWithHasCount: redirects.filter((r: any) => !!r.has).length,\n          middlewareCount: hasMiddlewareFile ? 1 : 0,\n          totalAppPagesCount,\n          staticAppPagesCount,\n          serverAppPagesCount,\n          edgeRuntimeAppCount,\n          edgeRuntimePagesCount,\n        })\n      )\n\n      if (NextBuildContext.telemetryState) {\n        const events = eventBuildFeatureUsage(\n          NextBuildContext.telemetryState.usages\n        )\n        telemetry.record(events)\n        telemetry.record(\n          eventPackageUsedInGetServerSideProps(\n            NextBuildContext.telemetryState.packagesUsedInServerSideProps\n          )\n        )\n        const useCacheTracker = NextBuildContext.telemetryState.useCacheTracker\n\n        for (const [key, value] of Object.entries(useCacheTracker)) {\n          telemetry.record(\n            eventBuildFeatureUsage([\n              {\n                featureName: key as UseCacheTrackerKey,\n                invocationCount: value,\n              },\n            ])\n          )\n        }\n      }\n\n      if (ssgPages.size > 0 || appDir) {\n        tbdPrerenderRoutes.forEach((tbdRoute) => {\n          const normalizedRoute = normalizePagePath(tbdRoute)\n          const dataRoute = path.posix.join(\n            '/_next/data',\n            buildId,\n            `${normalizedRoute}.json`\n          )\n\n          prerenderManifest.dynamicRoutes[tbdRoute] = {\n            routeRegex: normalizeRouteRegex(\n              getNamedRouteRegex(tbdRoute, {\n                prefixRouteKeys: false,\n              }).re.source\n            ),\n            experimentalPPR: undefined,\n            renderingMode: undefined,\n            dataRoute,\n            fallback: ssgBlockingFallbackPages.has(tbdRoute)\n              ? null\n              : ssgStaticFallbackPages.has(tbdRoute)\n                ? `${normalizedRoute}.html`\n                : false,\n            fallbackRevalidate: undefined,\n            fallbackExpire: undefined,\n            fallbackSourceRoute: undefined,\n            fallbackRootParams: undefined,\n            dataRouteRegex: normalizeRouteRegex(\n              getNamedRouteRegex(dataRoute, {\n                prefixRouteKeys: true,\n                includeSuffix: true,\n                excludeOptionalTrailingSlash: true,\n              }).re.source\n            ),\n            // Pages does not have a prefetch data route.\n            prefetchDataRoute: undefined,\n            prefetchDataRouteRegex: undefined,\n            allowHeader: ALLOWED_HEADERS,\n          }\n        })\n\n        NextBuildContext.previewModeId = previewProps.previewModeId\n        NextBuildContext.fetchCacheKeyPrefix =\n          config.experimental.fetchCacheKeyPrefix\n        NextBuildContext.allowedRevalidateHeaderKeys =\n          config.experimental.allowedRevalidateHeaderKeys\n\n        await writePrerenderManifest(distDir, prerenderManifest)\n        await writeClientSsgManifest(prerenderManifest, {\n          distDir,\n          buildId,\n          locales: config.i18n?.locales,\n        })\n      } else {\n        await writePrerenderManifest(distDir, {\n          version: 4,\n          routes: {},\n          dynamicRoutes: {},\n          preview: previewProps,\n          notFoundRoutes: [],\n        })\n      }\n\n      await writeImagesManifest(distDir, config)\n      await writeManifest(path.join(distDir, EXPORT_MARKER), {\n        version: 1,\n        hasExportPathMap: typeof config.exportPathMap === 'function',\n        exportTrailingSlash: config.trailingSlash === true,\n        isNextImageImported: isNextImageImported === true,\n      })\n      await fs.unlink(path.join(distDir, EXPORT_DETAIL)).catch((err) => {\n        if (err.code === 'ENOENT') {\n          return Promise.resolve()\n        }\n        return Promise.reject(err)\n      })\n\n      if (Boolean(config.experimental.nextScriptWorkers)) {\n        await nextBuildSpan\n          .traceChild('verify-partytown-setup')\n          .traceAsyncFn(async () => {\n            await verifyPartytownSetup(\n              dir,\n              path.join(distDir, CLIENT_STATIC_FILES_PATH)\n            )\n          })\n      }\n\n      await buildTracesPromise\n\n      if (buildTracesSpinner) {\n        buildTracesSpinner.stopAndPersist()\n        buildTracesSpinner = undefined\n      }\n\n      if (isCompileMode) {\n        Log.info(\n          `Build ran with \"compile\" mode, to finalize the build run either \"generate\" or \"generate-env\" mode as well`\n        )\n      }\n\n      if (config.output === 'export') {\n        await writeFullyStaticExport(\n          config,\n          dir,\n          enabledDirectories,\n          configOutDir,\n          nextBuildSpan\n        )\n      }\n\n      if (config.output === 'standalone') {\n        await writeStandaloneDirectory(\n          nextBuildSpan,\n          distDir,\n          pageKeys,\n          denormalizedAppPages,\n          outputFileTracingRoot,\n          requiredServerFilesManifest,\n          middlewareManifest,\n          hasNodeMiddleware,\n          hasInstrumentationHook,\n          staticPages,\n          loadedEnvFiles,\n          appDir\n        )\n      }\n\n      if (postBuildSpinner) postBuildSpinner.stopAndPersist()\n      console.log()\n\n      if (debugOutput) {\n        nextBuildSpan\n          .traceChild('print-custom-routes')\n          .traceFn(() => printCustomRoutes({ redirects, rewrites, headers }))\n      }\n\n      await nextBuildSpan.traceChild('print-tree-view').traceAsyncFn(() =>\n        printTreeView(pageKeys, pageInfos, {\n          distPath: distDir,\n          buildId: buildId,\n          pagesDir,\n          useStaticPages404,\n          pageExtensions: config.pageExtensions,\n          appBuildManifest,\n          buildManifest,\n          middlewareManifest,\n          gzipSize: config.experimental.gzipSize,\n        })\n      )\n\n      await nextBuildSpan\n        .traceChild('telemetry-flush')\n        .traceAsyncFn(() => telemetry.flush())\n\n      await shutdownPromise\n    })\n  } catch (e) {\n    const telemetry: Telemetry | undefined = traceGlobals.get('telemetry')\n    if (telemetry) {\n      telemetry.record(\n        eventBuildFailed({\n          bundler: getBundlerForTelemetry(isTurbopack),\n          errorCode: getErrorCodeForTelemetry(e),\n          durationInSeconds: Math.floor((Date.now() - buildStartTime) / 1000),\n        })\n      )\n    }\n    throw e\n  } finally {\n    // Ensure we wait for lockfile patching if present\n    await lockfilePatchPromise.cur\n\n    if (isTurbopack && !process.env.__NEXT_TEST_MODE) {\n      warnAboutTurbopackBuilds(loadedConfig)\n    }\n\n    // Ensure all traces are flushed before finishing the command\n    await flushAllTraces()\n    teardownTraceSubscriber()\n\n    if (traceUploadUrl && loadedConfig) {\n      uploadTrace({\n        traceUploadUrl,\n        mode: 'build',\n        projectDir: dir,\n        distDir: loadedConfig.distDir,\n        isTurboSession: isTurbopack,\n        sync: true,\n      })\n    }\n  }\n}\n\nfunction warnAboutTurbopackBuilds(config?: NextConfigComplete) {\n  let warningStr =\n    `Support for Turbopack builds is experimental. ` +\n    bold(\n      `We don't recommend deploying mission-critical applications to production.`\n    )\n  warningStr +=\n    '\\n\\n- ' +\n    bold(\n      'Turbopack currently always builds production source maps for the browser. This will include project source code if deployed to production.'\n    )\n  warningStr +=\n    '\\n- It is expected that your bundle size might be different from `next build` with webpack. This will be improved as we work towards stability.'\n\n  if (!config?.experimental.turbopackPersistentCaching) {\n    warningStr +=\n      '\\n- This build is without disk caching; subsequent builds will become faster when disk caching becomes available.'\n  }\n\n  warningStr +=\n    '\\n- When comparing output to webpack builds, make sure to first clear the Next.js cache by deleting the `.next` directory.'\n  warningStr +=\n    '\\n\\nProvide feedback for Turbopack builds at https://github.com/vercel/next.js/discussions/77721'\n\n  Log.warn(warningStr)\n}\n\nfunction getBundlerForTelemetry(isTurbopack: boolean) {\n  if (isTurbopack) {\n    return 'turbopack'\n  }\n\n  if (process.env.NEXT_RSPACK) {\n    return 'rspack'\n  }\n\n  return 'webpack'\n}\n\nfunction getErrorCodeForTelemetry(err: unknown) {\n  const code = extractNextErrorCode(err)\n  if (code != null) {\n    return code\n  }\n\n  if (err instanceof Error && 'code' in err && typeof err.code === 'string') {\n    return err.code\n  }\n\n  if (err instanceof Error) {\n    return err.name\n  }\n\n  return 'Unknown'\n}\n"],"names":["loadEnvConfig","bold","yellow","crypto","makeRe","existsSync","promises","fs","os","Worker","defaultConfig","devalue","findUp","nanoid","path","STATIC_STATUS_PAGE_GET_INITIAL_PROPS_ERROR","PUBLIC_DIR_MIDDLEWARE_CONFLICT","MIDDLEWARE_FILENAME","PAGES_DIR_ALIAS","INSTRUMENTATION_HOOK_FILENAME","RSC_PREFETCH_SUFFIX","RSC_SUFFIX","NEXT_RESUME_HEADER","PRERENDER_REVALIDATE_HEADER","PRERENDER_REVALIDATE_ONLY_GENERATED_HEADER","NEXT_CACHE_REVALIDATE_TAG_TOKEN_HEADER","NEXT_CACHE_REVALIDATED_TAGS_HEADER","MATCHED_PATH_HEADER","RSC_SEGMENTS_DIR_SUFFIX","RSC_SEGMENT_SUFFIX","FileType","fileExists","findPagesDir","loadCustomRoutes","normalizeRouteRegex","nonNullable","recursiveDelete","verifyPartytownSetup","BUILD_ID_FILE","BUILD_MANIFEST","CLIENT_STATIC_FILES_PATH","EXPORT_DETAIL","EXPORT_MARKER","IMAGES_MANIFEST","PAGES_MANIFEST","PHASE_PRODUCTION_BUILD","PRERENDER_MANIFEST","REACT_LOADABLE_MANIFEST","ROUTES_MANIFEST","SERVER_DIRECTORY","SERVER_FILES_MANIFEST","STATIC_STATUS_PAGES","MIDDLEWARE_MANIFEST","APP_PATHS_MANIFEST","APP_PATH_ROUTES_MANIFEST","APP_BUILD_MANIFEST","RSC_MODULE_TYPES","NEXT_FONT_MANIFEST","SUBRESOURCE_INTEGRITY_MANIFEST","MIDDLEWARE_BUILD_MANIFEST","MIDDLEWARE_REACT_LOADABLE_MANIFEST","SERVER_REFERENCE_MANIFEST","FUNCTIONS_CONFIG_MANIFEST","UNDERSCORE_NOT_FOUND_ROUTE_ENTRY","UNDERSCORE_NOT_FOUND_ROUTE","DYNAMIC_CSS_MANIFEST","TURBOPACK_CLIENT_MIDDLEWARE_MANIFEST","getSortedRoutes","isDynamicRoute","getSortedRouteObjects","loadConfig","normalizePagePath","getPagePath","ciEnvironment","turborepoTraceAccess","TurborepoAccessTraceResult","writeTurborepoAccessTraceResult","eventBuildOptimize","eventCliSession","eventBuildFeatureUsage","eventNextPlugins","EVENT_BUILD_FEATURE_USAGE","eventPackageUsedInGetServerSideProps","eventBuildCompleted","eventBuildFailed","Telemetry","hadUnsupportedValue","createPagesMapping","getStaticInfoIncludingLayouts","sortByPageExts","PAGE_TYPES","generateBuildId","isWriteable","Log","createSpinner","trace","flushAllTraces","setGlobal","detectConflictingPaths","computeFromManifest","getJsPageSizeInKb","printCustomRoutes","printTreeView","copyTracedFiles","isReservedPage","isAppBuiltinNotFoundPage","collectRoutesUsingEdgeRuntime","collectMeta","writeBuildId","normalizeLocalePath","isError","isEdgeRuntime","recursiveCopy","recursiveReadDir","lockfilePatchPromise","teardownTraceSubscriber","getNamedRouteRegex","getFilesInDir","eventSwcPlugins","normalizeAppPath","ACTION_HEADER","NEXT_ROUTER_PREFETCH_HEADER","RSC_HEADER","RSC_CONTENT_TYPE_HEADER","NEXT_ROUTER_STATE_TREE_HEADER","NEXT_DID_POSTPONE_HEADER","NEXT_ROUTER_SEGMENT_PREFETCH_HEADER","NEXT_REWRITTEN_PATH_HEADER","NEXT_REWRITTEN_QUERY_HEADER","webpackBuild","NextBuildContext","normalizePathSep","isAppRouteRoute","createClientRouterFilter","createValidFileMatcher","startTypeChecking","generateInterceptionRoutesRewrites","buildDataRoute","collectBuildTraces","formatManifest","recordFrameworkVersion","updateBuildDiagnostics","recordFetchMetrics","getStartServerInfo","logStartInfo","hasCustomExportOutput","buildCustomRoute","traceMemoryUsage","generateEncryptionKeyBase64","uploadTrace","checkIsAppPPREnabled","checkIsRoutePPREnabled","FallbackMode","fallbackModeToFallbackField","RenderingMode","InvariantError","HTML_LIMITED_BOT_UA_RE_STRING","buildInversePrefetchSegmentDataRoute","buildPrefetchSegmentDataRoute","turbopackBuild","isPersistentCachingEnabled","inlineStaticEnv","populateStaticEnv","durationToString","traceGlobals","extractNextErrorCode","runAfterProductionCompile","ALLOWED_HEADERS","pageToRoute","page","routeRegex","prefixRouteKeys","regex","re","source","routeKeys","namedRegex","getCacheDir","distDir","cacheDir","join","isCI","hasNextSupport","hasCache","console","log","prefixes","warn","writeFileUtf8","filePath","content","writeFile","readFileUtf8","readFile","writeManifest","manifest","readManifest","JSON","parse","writePrerenderManifest","writeClientSsgManifest","prerenderManifest","buildId","locales","ssgPages","Set","Object","entries","routes","filter","srcRoute","map","route","pathname","keys","dynamicRoutes","sort","clientSsgManifestContent","writeFunctionsConfigManifest","writeRequiredServerFilesManifest","requiredServerFiles","writeImagesManifest","config","images","deviceSizes","imageSizes","sizes","remotePatterns","p","protocol","replace","hostname","port","dot","search","localPatterns","version","STANDALONE_DIRECTORY","writeStandaloneDirectory","nextBuildSpan","pageKeys","denormalizedAppPages","outputFileTracingRoot","middlewareManifest","hasNodeMiddleware","hasInstrumentationHook","staticPages","loadedEnvFiles","appDir","traceChild","traceAsyncFn","pages","file","files","reduce","acc","envFile","includes","push","outputPath","relative","mkdir","dirname","recursive","copyFile","middlewareOutput","overwrite","originalServerApp","getNumberOfWorkers","experimental","cpus","memoryBasedWorkersCount","Math","max","min","floor","freemem","staticWorkerPath","require","resolve","staticWorkerExposedMethods","createStaticWorker","options","debuggerPortOffset","progress","logger","numWorkers","onActivity","run","onActivityAbort","clear","enableSourceMaps","enablePrerenderSourceMaps","isolatedMemory","enableWorkerThreads","workerThreads","exposedMethods","writeFullyStaticExport","dir","enabledDirectories","configOutDir","exportApp","default","buildExport","nextConfig","silent","outdir","getBuildId","isGenerateMode","build","reactProductionProfiling","debugOutput","runLint","noMangling","appDirOnly","isTurbopack","experimentalBuildMode","traceUploadUrl","isCompileMode","buildStartTime","Date","now","loadedConfig","undefined","buildMode","isTurboBuild","String","process","env","__NEXT_VERSION","mappedPages","traceFn","turborepoAccessTraceResult","NEXT_DEPLOYMENT_ID","deploymentId","exit","info","customRoutes","headers","rewrites","redirects","combinedRewrites","beforeFiles","afterFiles","fallback","hasRewrites","length","originalRewrites","_originalRewrites","originalRedirects","_originalRedirects","telemetry","publicDir","pagesDir","app","encryptionKey","isBuild","isSrcDir","startsWith","hasPublicDir","record","webpackVersion","cliCommand","hasNowJson","cwd","isCustomServer","turboFlag","then","events","envInfo","experimentalFeatures","networkUrl","appUrl","ignoreESLint","Boolean","eslint","ignoreDuringBuilds","shouldLint","typeCheckingOptions","distDirCreated","err","code","Error","cleanDistDir","error","flush","buildLintEvent","featureName","invocationCount","eventName","payload","validFileMatcher","pageExtensions","providedPagePaths","NEXT_PRIVATE_PAGE_PATHS","pagesPaths","pathnameFilter","isPageFile","middlewareDetectionRegExp","RegExp","instrumentationHookDetectionRegExp","rootDir","rootPaths","Array","from","some","include","test","hasMiddlewareFile","previewProps","previewModeId","randomBytes","toString","previewModeSigningKey","previewModeEncryptionKey","isDev","pagesType","PAGES","pagePaths","mappedAppPages","providedAppPaths","NEXT_PRIVATE_APP_PATHS","appPaths","absolutePath","isAppRouterPage","isRootNotFound","ignorePartFilter","part","APP","mappedRootPaths","ROOT","pagesPageKeys","conflictingAppPagePaths","appPageKeys","appKey","normalizedAppPageKey","pagePath","appPath","add","basePath","totalAppPagesCount","numConflictingAppPaths","conflictingPublicFiles","hasPages404","hasApp404","hasCustomErrorPage","hasPublicUnderScoreNextDir","hasPublicPageFile","File","numConflicting","nestedReservedPages","match","restrictedRedirectPaths","isAppDynamicIOEnabled","dynamicIO","isAuthInterruptsEnabled","authInterrupts","isAppPPREnabled","ppr","routesManifestPath","routesManifest","sortedRoutes","staticRoutes","pages404","caseSensitive","caseSensitiveRoutes","r","dataRoutes","i18n","rsc","header","varyHeader","prefetchHeader","didPostponeHeader","contentTypeHeader","suffix","prefetchSuffix","prefetchSegmentHeader","prefetchSegmentSuffix","prefetchSegmentDirSuffix","rewriteHeaders","pathHeader","queryHeader","skipMiddlewareUrlNormalize","chain","clientRouterFilters","clientRouterFilter","nonInternalRedirects","internal","clientRouterFilterRedirects","clientRouterFilterAllowedRate","buildStage","pagesManifestPath","buildTraceContext","buildTracesPromise","useBuildWorker","webpackBuildWorker","webpack","runServerAndEdgeInParallel","parallelServerCompiles","collectServerBuildTracesInParallel","parallelServerBuildTraces","setAttribute","buildOptions","shutdownPromise","Promise","duration","compilerDuration","rest","NEXT_TURBOPACK_USE_WORKER","durationString","event","bundler","durationInSeconds","round","serverBuildPromise","res","buildTraceWorker","edgeRuntimeRoutes","Map","hasSsrAmpPages","catch","edgeBuildPromise","getBundlerForTelemetry","buildSpan","metadata","projectDir","postCompileSpinner","buildManifestPath","appBuildManifestPath","staticAppPagesCount","serverAppPagesCount","edgeRuntimeAppCount","edgeRuntimePagesCount","ssgStaticFallbackPages","ssgBlockingFallbackPages","invalidPages","hybridAmpPages","serverPropsPages","additionalPaths","staticPaths","appNormalizedPaths","fallbackModes","appDefaultConfigs","pageInfos","pagesManifest","buildManifest","appBuildManifest","appPathRoutes","appPathsManifest","key","NEXT_PHASE","worker","analysisBegin","hrtime","staticCheckSpan","functionsConfigManifest","functions","customAppGetInitialProps","namedExports","isNextImageImported","hasNonStaticErrorPage","configFileName","publicRuntimeConfig","serverRuntimeConfig","runtimeEnvConfig","sriEnabled","sri","algorithm","nonStaticErrorPageSpan","errorPageHasCustomGetInitialProps","hasCustomGetInitialProps","checkingApp","errorPageStaticResult","isPageStatic","httpAgentOptions","defaultLocale","nextConfigOutput","output","pprConfig","cacheLifeProfiles","cacheLife","appPageToCheck","customAppGetInitialPropsPromise","namedExportsPromise","getDefinedNamedExports","computedManifestData","gzipSize","actionManifest","entriesWithAction","id","node","entry","workers","edge","all","pageType","checkPageSpan","actualPage","size","totalSize","isRoutePPREnabled","isSSG","isStatic","isServerComponent","isHybridAmp","ssgPageRoutes","find","originalAppPath","originalPath","normalizedPath","pageFilePath","isInsideAppDir","staticInfo","runtime","maxDuration","pageRuntime","client","edgeInfo","manifestKey","isPageStaticSpan","workerResult","parentId","getId","cacheHandler","cacheHandlers","isrFlushToDisk","maxMemoryCacheSize","cacheMaxMemorySize","set","warnOnce","isDynamic","prerenderedRoutes","appConfig","revalidate","hasGenerateStaticParams","params","encodedPathname","fallbackRouteParams","fallbackMode","prerenderFallbackMode","fallbackRootParams","throwOnEmptyStaticShell","dynamic","hasStaticProps","isAmpOnly","BLOCKING_STATIC_RENDER","PRERENDER","hasServerProps","delete","message","initialCacheControl","pageDuration","ssgPageDurations","hasEmptyStaticShell","errorPageResult","nonStaticErrorPage","returnValue","stopAndPersist","instrumentationHookEntryFiles","requiredServerFilesManifest","normalizedCacheHandlers","value","serverFilesManifest","configFile","compress","trustHostHeader","isExperimentalCompile","relativeAppDir","ignore","middlewareFile","matchers","middleware","regexp","originalSource","useStaticPages404","pg","optimizeCss","globOrig","cssFilePaths","reject","features","nextScriptWorkers","feature","notFoundRoutes","preview","tbdPrerenderRoutes","usedStaticStatusPages","forEach","has","hasPages500","useDefaultStatic500","combinedPages","isApp404Static","hasStaticApp404","staticGenerationSpan","exportConfig","exportPathMap","defaultMap","_pagesFallback","_ssgPath","get","isDynamicError","_fallbackRouteParams","_isDynamicError","_isAppDir","_isRoutePPREnabled","_allowEmptyStaticShell","isSsg","isFallback","locale","_locale","exportResult","statusMessage","getFallbackMode","byPath","NOT_FOUND","getCacheControl","exportPath","defaultRevalidate","cacheControl","expire","expireTime","NEXT_SSG_FETCH_METRICS","traces","turborepoAccessTraceResults","values","ssgNotFoundPaths","serverBundle","unlink","hasRevalidateZero","isAppRouteHandler","htmlBotsRegexString","htmlLimitedBots","bypassFor","type","unknownPrerenderRoutes","knownPrerenderRoutes","prerenderedRoute","hasPostponed","normalizedRoute","dataRoute","posix","prefetchDataRoute","meta","initialStatus","status","initialHeaders","renderingMode","PARTIALLY_STATIC","STATIC","experimentalPPR","experimentalBypassFor","initialRevalidateSeconds","initialExpireSeconds","allowHeader","segmentPaths","dynamicRoute","prefetchSegmentDataRoutes","segmentPath","isDynamicAppRoute","fallbackCacheControl","fallbackRevalidate","fallbackExpire","fallbackStatus","fallbackHeaders","fallbackSourceRoute","dataRouteRegex","includeSuffix","excludeOptionalTrailingSlash","prefetchDataRouteRegex","moveExportedPage","originPage","ext","additionalSsgFile","orig","relativeDest","slice","split","dest","isNotFound","rename","localeExt","extname","relativeDestNoPages","curPath","updatedRelativeDest","updatedOrig","updatedDest","moveExportedAppNotFoundTo404","isStaticSsgFallback","hasAmp","pageInfo","durationInfo","byPage","durationsByPath","hasHtmlOutput","ampPage","localePage","pageFile","rm","force","clientSegmentCache","postBuildSpinner","buildTracesSpinner","end","analysisEnd","staticPageCount","staticPropsPageCount","serverPropsPageCount","ssrPageCount","hasStatic404","hasReportWebVitals","rewritesCount","headersCount","redirectsCount","headersWithHasCount","rewritesWithHasCount","redirectsWithHasCount","middlewareCount","telemetryState","usages","packagesUsedInServerSideProps","useCacheTracker","tbdRoute","fetchCacheKeyPrefix","allowedRevalidateHeaderKeys","hasExportPathMap","exportTrailingSlash","trailingSlash","distPath","e","errorCode","getErrorCodeForTelemetry","cur","__NEXT_TEST_MODE","warnAboutTurbopackBuilds","mode","isTurboSession","sync","warningStr","turbopackPersistentCaching","NEXT_RSPACK","name"],"mappings":"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","ignoreList":[0]}